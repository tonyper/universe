(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.universe=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=require("./src/crossfilter").crossfilter},{"./src/crossfilter":5}],2:[function(require,module,exports){module.exports={_args:[[{raw:"crossfilter2@1.4.0-alpha.6",scope:null,escapedName:"crossfilter2",name:"crossfilter2",rawSpec:"1.4.0-alpha.6",spec:"1.4.0-alpha.6",type:"version"},"/Users/apetiot/dev/universe"]],_from:"crossfilter2@1.4.0-alpha.6",_id:"crossfilter2@1.4.0-alpha.6",_inCache:true,_location:"/crossfilter2",_nodeVersion:"5.10.1",_npmOperationalInternal:{host:"packages-12-west.internal.npmjs.com",tmp:"tmp/crossfilter2-1.4.0-alpha.6.tgz_1463519571786_0.49269671249203384"},_npmUser:{name:"esjewett",email:"esjewett@gmail.com"},_npmVersion:"3.8.3",_phantomChildren:{},_requested:{raw:"crossfilter2@1.4.0-alpha.6",scope:null,escapedName:"crossfilter2",name:"crossfilter2",rawSpec:"1.4.0-alpha.6",spec:"1.4.0-alpha.6",type:"version"},_requiredBy:["/","/reductio"],_resolved:"https://registry.npmjs.org/crossfilter2/-/crossfilter2-1.4.0-alpha.6.tgz",_shasum:"f0197c6fab2d6a583b51254bfc6357093f80521b",_shrinkwrap:null,_spec:"crossfilter2@1.4.0-alpha.6",_where:"/Users/apetiot/dev/universe",author:{name:"Mike Bostock",url:"http://bost.ocks.org/mike"},bugs:{url:"https://github.com/crossfilter/crossfilter/issues"},contributors:[{name:"Jason Davies",url:"http://www.jasondavies.com/"}],dependencies:{"lodash.result":"^4.4.0"},description:"Fast multidimensional filtering for coordinated views.",devDependencies:{browserify:"^13.0.0",d3:"3.5","package-json-versionify":"1.0.2","uglify-js":"2.4.0",vows:"0.7.0"},directories:{},dist:{shasum:"f0197c6fab2d6a583b51254bfc6357093f80521b",tarball:"https://registry.npmjs.org/crossfilter2/-/crossfilter2-1.4.0-alpha.6.tgz"},files:["src","index.js","crossfilter.js","crossfilter.min.js"],gitHead:"509a96798f5153a58d1b6cae5fb3e7893129ce7c",homepage:"http://crossfilter.github.com/crossfilter/",keywords:["analytics","visualization","crossfilter"],main:"./index.js",maintainers:[{name:"esjewett",email:"esjewett@gmail.com"},{name:"gordonwoodhull",email:"gordon@woodhull.com"},{name:"tannerlinsley",email:"tannerlinsley@gmail.com"}],name:"crossfilter2",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/crossfilter/crossfilter.git"},scripts:{benchmark:"node test/benchmark.js",build:"browserify index.js -t package-json-versionify --standalone crossfilter -o crossfilter.js && uglifyjs --compress --mangle --screw-ie8 crossfilter.js -o crossfilter.min.js",clean:"rm -f crossfilter.js crossfilter.min.js",test:"vows --verbose"},version:"1.4.0-alpha.6"}},{}],3:[function(require,module,exports){if(typeof Uint8Array!=="undefined"){crossfilter_array8=function(n){return new Uint8Array(n)};crossfilter_array16=function(n){return new Uint16Array(n)};crossfilter_array32=function(n){return new Uint32Array(n)};crossfilter_arrayLengthen=function(array,length){if(array.length>=length)return array;var copy=new array.constructor(length);copy.set(array);return copy};crossfilter_arrayWiden=function(array,width){var copy;switch(width){case 16:copy=crossfilter_array16(array.length);break;case 32:copy=crossfilter_array32(array.length);break;default:throw new Error("invalid array width!")}copy.set(array);return copy}}function crossfilter_arrayUntyped(n){var array=new Array(n),i=-1;while(++i<n)array[i]=0;return array}function crossfilter_arrayLengthenUntyped(array,length){var n=array.length;while(n<length)array[n++]=0;return array}function crossfilter_arrayWidenUntyped(array,width){if(width>32)throw new Error("invalid array width!");return array}function crossfilter_bitarray(n){this.length=n;this.subarrays=1;this.width=8;this.masks={0:0};this[0]=crossfilter_array8(n)}crossfilter_bitarray.prototype.lengthen=function(n){var i,len;for(i=0,len=this.subarrays;i<len;++i){this[i]=crossfilter_arrayLengthen(this[i],n)}this.length=n};crossfilter_bitarray.prototype.add=function(){var m,w,one,i,len;for(i=0,len=this.subarrays;i<len;++i){m=this.masks[i];w=this.width-32*i;one=~m&-~m;if(w>=32&&!one){continue}if(w<32&&one&1<<w){this[i]=crossfilter_arrayWiden(this[i],w<<=1);this.width=32*i+w}this.masks[i]|=one;return{offset:i,one:one}}this[this.subarrays]=crossfilter_array8(this.length);this.masks[this.subarrays]=1;this.width+=8;return{offset:this.subarrays++,one:1}};crossfilter_bitarray.prototype.copy=function(dest,src){var i,len;for(i=0,len=this.subarrays;i<len;++i){this[i][dest]=this[i][src]}};crossfilter_bitarray.prototype.truncate=function(n){var i,len;for(i=0,len=this.subarrays;i<len;++i){for(var j=this.length-1;j>=n;j--){this[i][j]=0}this[i].length=n}this.length=n};crossfilter_bitarray.prototype.zero=function(n){var i,len;for(i=0,len=this.subarrays;i<len;++i){if(this[i][n]){return false}}return true};crossfilter_bitarray.prototype.zeroExcept=function(n,offset,zero){var i,len;for(i=0,len=this.subarrays;i<len;++i){if(i===offset?this[i][n]&zero:this[i][n]){return false}}return true};crossfilter_bitarray.prototype.zeroExceptMask=function(n,mask){var i,len;for(i=0,len=this.subarrays;i<len;++i){if(this[i][n]&mask[i]){return false}}return true};crossfilter_bitarray.prototype.only=function(n,offset,one){var i,len;for(i=0,len=this.subarrays;i<len;++i){if(this[i][n]!=(i===offset?one:0)){return false}}return true};crossfilter_bitarray.prototype.onlyExcept=function(n,offset,zero,onlyOffset,onlyOne){var mask;var i,len;for(i=0,len=this.subarrays;i<len;++i){mask=this[i][n];if(i===offset)mask&=zero;if(mask!=(i===onlyOffset?onlyOne:0)){return false}}return true};module.exports={array8:crossfilter_arrayUntyped,array16:crossfilter_arrayUntyped,array32:crossfilter_arrayUntyped,arrayLengthen:crossfilter_arrayLengthenUntyped,arrayWiden:crossfilter_arrayWidenUntyped,bitarray:crossfilter_bitarray}},{}],4:[function(require,module,exports){var crossfilter_identity=require("./identity");function bisect_by(f){function bisectLeft(a,x,lo,hi){while(lo<hi){var mid=lo+hi>>>1;if(f(a[mid])<x)lo=mid+1;else hi=mid}return lo}function bisectRight(a,x,lo,hi){while(lo<hi){var mid=lo+hi>>>1;if(x<f(a[mid]))hi=mid;else lo=mid+1}return lo}bisectRight.right=bisectRight;bisectRight.left=bisectLeft;return bisectRight}module.exports=bisect_by(crossfilter_identity);module.exports.by=bisect_by},{"./identity":9}],5:[function(require,module,exports){var xfilterArray=require("./array");var xfilterFilter=require("./filter");var crossfilter_identity=require("./identity");var crossfilter_null=require("./null");var crossfilter_zero=require("./zero");var xfilterHeapselect=require("./heapselect");var xfilterHeap=require("./heap");var bisect=require("./bisect");var insertionsort=require("./insertionsort");var permute=require("./permute");var quicksort=require("./quicksort");var xfilterReduce=require("./reduce");var packageJson=require("./../package.json");var result=require("lodash.result");exports.crossfilter=crossfilter;exports.crossfilter.heap=xfilterHeap;exports.crossfilter.heapselect=xfilterHeapselect;exports.crossfilter.bisect=bisect;exports.crossfilter.insertionsort=insertionsort;exports.crossfilter.permute=permute;exports.crossfilter.quicksort=quicksort;exports.crossfilter.version=packageJson.version;function crossfilter(){var crossfilter={add:add,remove:removeData,dimension:dimension,groupAll:groupAll,size:size,all:all,onChange:onChange,isElementFiltered:isElementFiltered};var data=[],n=0,filters,filterListeners=[],dataListeners=[],removeDataListeners=[],callbacks=[];filters=new xfilterArray.bitarray(0);function add(newData){var n0=n,n1=newData.length;if(n1){data=data.concat(newData);filters.lengthen(n+=n1);dataListeners.forEach(function(l){l(newData,n0,n1)});triggerOnChange("dataAdded")}return crossfilter}function removeData(){var newIndex=crossfilter_index(n,n),removed=[];for(var i=0,j=0;i<n;++i){if(!filters.zero(i))newIndex[i]=j++;else removed.push(i)}filterListeners.forEach(function(l){l(-1,-1,[],removed,true)});removeDataListeners.forEach(function(l){l(newIndex)});for(var i=0,j=0;i<n;++i){if(!filters.zero(i)){if(i!==j)filters.copy(j,i),data[j]=data[i];++j}}data.length=n=j;filters.truncate(j);triggerOnChange("dataRemoved")}function isElementFiltered(i,ignore_dimensions){var n,d,id,len,mask=Array(filters.subarrays);for(n=0;n<filters.subarrays;n++){mask[n]=~0}if(ignore_dimensions){for(d=0,len=ignore_dimensions.length;d<len;d++){id=ignore_dimensions[d].id();mask[id>>7]&=~(1<<(id&63))}}return filters.zeroExceptMask(i,mask)}function dimension(value,iterable){if(typeof value==="string"){var accessorPath=value;value=function(d){return result(d,accessorPath)}}var dimension={filter:filter,filterExact:filterExact,filterRange:filterRange,filterFunction:filterFunction,filterAll:filterAll,top:top,bottom:bottom,group:group,groupAll:groupAll,dispose:dispose,remove:dispose,accessor:value,id:function(){return id}};var one,zero,offset,id,values,index,oldValues,oldIndex,newValues,newIndex,iterablesIndexCount,newIterablesIndexCount,iterablesIndexFilterStatus,newIterablesIndexFilterStatus,oldIterablesIndexFilterStatus,iterablesEmptyRows,sort=quicksort.by(function(i){return newValues[i]}),refilter=xfilterFilter.filterAll,refilterFunction,indexListeners=[],dimensionGroups=[],lo0=0,hi0=0,t=0;dataListeners.unshift(preAdd);dataListeners.push(postAdd);removeDataListeners.push(removeData);var tmp=filters.add();offset=tmp.offset;one=tmp.one;zero=~one;id=offset<<7|Math.log(one)/Math.log(2);preAdd(data,0,n);postAdd(data,0,n);function preAdd(newData,n0,n1){if(iterable){t=0;j=0;k=[];for(i=0;i<newData.length;i++){for(j=0,k=value(newData[i]);j<k.length;j++){t++}}newValues=[];newIterablesIndexCount=crossfilter_range(newData.length);newIterablesIndexFilterStatus=crossfilter_index(t,1);iterablesEmptyRows=[];var unsortedIndex=crossfilter_range(t);for(l=0,i=0;i<newData.length;i++){k=value(newData[i]);if(!k.length){newIterablesIndexCount[i]=0;iterablesEmptyRows.push(i);continue}newIterablesIndexCount[i]=k.length;for(j=0;j<k.length;j++){newValues.push(k[j]);unsortedIndex[l]=i;l++}}var sortMap=sort(crossfilter_range(t),0,t);newValues=permute(newValues,sortMap);newIndex=permute(unsortedIndex,sortMap)}else{newValues=newData.map(value);newIndex=sort(crossfilter_range(n1),0,n1);newValues=permute(newValues,newIndex)}if(iterable){n1=t}var bounds=refilter(newValues),lo1=bounds[0],hi1=bounds[1];if(refilterFunction){for(i=0;i<n1;++i){if(!refilterFunction(newValues[i],i)){filters[offset][newIndex[i]+n0]|=one;if(iterable)newIterablesIndexFilterStatus[i]=1}}}else{for(i=0;i<lo1;++i){filters[offset][newIndex[i]+n0]|=one;if(iterable)newIterablesIndexFilterStatus[i]=1}for(i=hi1;i<n1;++i){filters[offset][newIndex[i]+n0]|=one;if(iterable)newIterablesIndexFilterStatus[i]=1}}if(!n0){values=newValues;index=newIndex;iterablesIndexCount=newIterablesIndexCount;iterablesIndexFilterStatus=newIterablesIndexFilterStatus;lo0=lo1;hi0=hi1;return}var oldValues=values,oldIndex=index,oldIterablesIndexFilterStatus=iterablesIndexFilterStatus;i0=0,i1=0;if(iterable){old_n0=n0;n0=oldValues.length;n1=t}values=iterable?new Array(n0+n1):new Array(n);index=iterable?new Array(n0+n1):crossfilter_index(n,n);if(iterable)iterablesIndexFilterStatus=crossfilter_index(n0+n1,1);if(iterable){var oldiiclength=iterablesIndexCount.length;iterablesIndexCount=xfilterArray.arrayLengthen(iterablesIndexCount,n);for(var j=0;j+oldiiclength<n;j++){iterablesIndexCount[j+oldiiclength]=newIterablesIndexCount[j]}}for(i=0;i0<n0&&i1<n1;++i){if(oldValues[i0]<newValues[i1]){values[i]=oldValues[i0];if(iterable)iterablesIndexFilterStatus[i]=oldIterablesIndexFilterStatus[i0];index[i]=oldIndex[i0++]}else{values[i]=newValues[i1];if(iterable)iterablesIndexFilterStatus[i]=oldIterablesIndexFilterStatus[i1];index[i]=newIndex[i1++]+(iterable?old_n0:n0)}}for(;i0<n0;++i0,++i){values[i]=oldValues[i0];if(iterable)iterablesIndexFilterStatus[i]=oldIterablesIndexFilterStatus[i0];index[i]=oldIndex[i0]}for(;i1<n1;++i1,++i){values[i]=newValues[i1];if(iterable)iterablesIndexFilterStatus[i]=oldIterablesIndexFilterStatus[i1];index[i]=newIndex[i1]+(iterable?old_n0:n0)}bounds=refilter(values),lo0=bounds[0],hi0=bounds[1]}function postAdd(newData,n0,n1){indexListeners.forEach(function(l){l(newValues,newIndex,n0,n1)});newValues=newIndex=null}function removeData(reIndex){for(var i=0,j=0,k;i<n;++i){if(!filters.zero(k=index[i])){if(i!==j)values[j]=values[i];index[j]=reIndex[k];++j}}values.length=j;while(j<n)index[j++]=0;var bounds=refilter(values);lo0=bounds[0],hi0=bounds[1]}function filterIndexBounds(bounds){var lo1=bounds[0],hi1=bounds[1];if(refilterFunction){refilterFunction=null;filterIndexFunction(function(d,i){return lo1<=i&&i<hi1},bounds[0]===0&&bounds[1]===index.length);lo0=lo1;hi0=hi1;return dimension}var i,j,k,added=[],removed=[],valueIndexAdded=[],valueIndexRemoved=[];if(lo1<lo0){for(i=lo1,j=Math.min(lo0,hi1);i<j;++i){added.push(index[i]);valueIndexAdded.push(i)}}else if(lo1>lo0){for(i=lo0,j=Math.min(lo1,hi0);i<j;++i){removed.push(index[i]);valueIndexRemoved.push(i)}}if(hi1>hi0){for(i=Math.max(lo1,hi0),j=hi1;i<j;++i){added.push(index[i]);valueIndexAdded.push(i)}}else if(hi1<hi0){for(i=Math.max(lo0,hi1),j=hi0;i<j;++i){removed.push(index[i]);valueIndexRemoved.push(i)}}if(!iterable){for(i=0;i<added.length;i++){filters[offset][added[i]]^=one}for(i=0;i<removed.length;i++){filters[offset][removed[i]]^=one}}else{var newAdded=[];var newRemoved=[];for(i=0;i<added.length;i++){iterablesIndexCount[added[i]]++;iterablesIndexFilterStatus[valueIndexAdded[i]]=0;if(iterablesIndexCount[added[i]]===1){filters[offset][added[i]]^=one;newAdded.push(added[i])}}for(i=0;i<removed.length;i++){iterablesIndexCount[removed[i]]--;iterablesIndexFilterStatus[valueIndexRemoved[i]]=1;if(iterablesIndexCount[removed[i]]===0){filters[offset][removed[i]]^=one;newRemoved.push(removed[i])}}added=newAdded;removed=newRemoved;if(bounds[0]===0&&bounds[1]===index.length){for(i=0;i<iterablesEmptyRows.length;i++){if(filters[offset][k=iterablesEmptyRows[i]]&one){filters[offset][k]^=one;added.push(k)}}}else{for(i=0;i<iterablesEmptyRows.length;i++){if(!(filters[offset][k=iterablesEmptyRows[i]]&one)){filters[offset][k]^=one;removed.push(k)}}}}lo0=lo1;hi0=hi1;filterListeners.forEach(function(l){l(one,offset,added,removed)});triggerOnChange("filtered");return dimension}function filter(range){return range==null?filterAll():Array.isArray(range)?filterRange(range):typeof range==="function"?filterFunction(range):filterExact(range)}function filterExact(value){return filterIndexBounds((refilter=xfilterFilter.filterExact(bisect,value))(values))}function filterRange(range){return filterIndexBounds((refilter=xfilterFilter.filterRange(bisect,range))(values))}function filterAll(){return filterIndexBounds((refilter=xfilterFilter.filterAll)(values))}function filterFunction(f){refilterFunction=f;refilter=xfilterFilter.filterAll;filterIndexFunction(f,false);lo0=0;hi0=n;return dimension}function filterIndexFunction(f,filterAll){var i,k,x,added=[],removed=[],valueIndexAdded=[],valueIndexRemoved=[],indexLength=index.length;if(!iterable){for(i=0;i<indexLength;++i){if(!(filters[offset][k=index[i]]&one)^!!(x=f(values[i],i))){if(x)added.push(k);else removed.push(k)}}}if(iterable){for(i=0;i<indexLength;++i){if(f(values[i],i)){added.push(index[i]);valueIndexAdded.push(i)}else{removed.push(index[i]);valueIndexRemoved.push(i)}}}if(!iterable){for(i=0;i<added.length;i++){if(filters[offset][added[i]]&one)filters[offset][added[i]]&=zero}for(i=0;i<removed.length;i++){if(!(filters[offset][removed[i]]&one))filters[offset][removed[i]]|=one}}else{var newAdded=[];var newRemoved=[];for(i=0;i<added.length;i++){if(iterablesIndexFilterStatus[valueIndexAdded[i]]===1){iterablesIndexCount[added[i]]++;iterablesIndexFilterStatus[valueIndexAdded[i]]=0;if(iterablesIndexCount[added[i]]===1){filters[offset][added[i]]^=one;newAdded.push(added[i])}}}for(i=0;i<removed.length;i++){if(iterablesIndexFilterStatus[valueIndexRemoved[i]]===0){iterablesIndexCount[removed[i]]--;iterablesIndexFilterStatus[valueIndexRemoved[i]]=1;if(iterablesIndexCount[removed[i]]===0){filters[offset][removed[i]]^=one;newRemoved.push(removed[i])}}}added=newAdded;removed=newRemoved;if(filterAll){for(i=0;i<iterablesEmptyRows.length;i++){if(filters[offset][k=iterablesEmptyRows[i]]&one){filters[offset][k]^=one;added.push(k)}}}else{for(i=0;i<iterablesEmptyRows.length;i++){if(!(filters[offset][k=iterablesEmptyRows[i]]&one)){filters[offset][k]^=one;removed.push(k)}}}}filterListeners.forEach(function(l){l(one,offset,added,removed)});triggerOnChange("filtered")}function top(k,top_offset){var array=[],i=hi0,j,toSkip=0;if(top_offset&&top_offset>0)toSkip=top_offset;while(--i>=lo0&&k>0){if(filters.zero(j=index[i])){if(toSkip>0){--toSkip}else{array.push(data[j]);--k}}}if(iterable){for(i=0;i<iterablesEmptyRows.length&&k>0;i++){if(filters.zero(j=iterablesEmptyRows[i])){if(toSkip>0){--toSkip}else{array.push(data[j]);--k}}}}return array}function bottom(k,bottom_offset){var array=[],i,j,toSkip=0;if(bottom_offset&&bottom_offset>0)toSkip=bottom_offset;if(iterable){for(i=0;i<iterablesEmptyRows.length&&k>0;i++){if(filters.zero(j=iterablesEmptyRows[i])){if(toSkip>0){--toSkip}else{array.push(data[j]);--k}}}}i=lo0;while(i<hi0&&k>0){if(filters.zero(j=index[i])){if(toSkip>0){--toSkip}else{array.push(data[j]);--k}}i++}return array}function group(key){var group={top:top,all:all,reduce:reduce,reduceCount:reduceCount,reduceSum:reduceSum,order:order,orderNatural:orderNatural,size:size,dispose:dispose,remove:dispose};dimensionGroups.push(group);var groups,groupIndex,groupWidth=8,groupCapacity=crossfilter_capacity(groupWidth),k=0,select,heap,reduceAdd,reduceRemove,reduceInitial,update=crossfilter_null,reset=crossfilter_null,resetNeeded=true,groupAll=key===crossfilter_null;if(arguments.length<1)key=crossfilter_identity;filterListeners.push(update);indexListeners.push(add);removeDataListeners.push(removeData);add(values,index,0,n);function add(newValues,newIndex,n0,n1){if(iterable){n0old=n0;n0=values.length-newValues.length;n1=newValues.length}var oldGroups=groups,reIndex=iterable?[]:crossfilter_index(k,groupCapacity),add=reduceAdd,remove=reduceRemove,initial=reduceInitial,k0=k,i0=0,i1=0,j,g0,x0,x1,g,x;if(resetNeeded)add=initial=crossfilter_null;if(resetNeeded)remove=initial=crossfilter_null;groups=new Array(k),k=0;if(iterable){groupIndex=k0>1?groupIndex:[]}else{groupIndex=k0>1?xfilterArray.arrayLengthen(groupIndex,n):crossfilter_index(n,groupCapacity)}if(k0)x0=(g0=oldGroups[0]).key;while(i1<n1&&!((x1=key(newValues[i1]))>=x1))++i1;while(i1<n1){if(g0&&x0<=x1){g=g0,x=x0;reIndex[i0]=k;if(g0=oldGroups[++i0])x0=g0.key}else{g={key:x1,value:initial()},x=x1}groups[k]=g;while(x1<=x){j=newIndex[i1]+(iterable?n0old:n0);if(iterable){if(groupIndex[j]){groupIndex[j].push(k)}else{groupIndex[j]=[k]}}else{groupIndex[j]=k}g.value=add(g.value,data[j],true);if(!filters.zeroExcept(j,offset,zero))g.value=remove(g.value,data[j],false);if(++i1>=n1)break;x1=key(newValues[i1])}groupIncrement()}while(i0<k0){groups[reIndex[i0]=k]=oldGroups[i0++];groupIncrement()}if(iterable){for(i=0;i<n;i++){if(!groupIndex[i]){groupIndex[i]=[]}}}if(k>i0){if(iterable){groupIndex=permute(groupIndex,reIndex,true)}else{for(i0=0;i0<n0;++i0){groupIndex[i0]=reIndex[groupIndex[i0]]}}}j=filterListeners.indexOf(update);if(k>1){update=updateMany;reset=resetMany}else{if(!k&&groupAll){k=1;groups=[{key:null,value:initial()}]}if(k===1){update=updateOne;reset=resetOne}else{update=crossfilter_null;reset=crossfilter_null}groupIndex=null}filterListeners[j]=update;function groupIncrement(){if(iterable){k++;return}if(++k===groupCapacity){reIndex=xfilterArray.arrayWiden(reIndex,groupWidth<<=1);groupIndex=xfilterArray.arrayWiden(groupIndex,groupWidth);groupCapacity=crossfilter_capacity(groupWidth)}}}function removeData(){if(k>1){var oldK=k,oldGroups=groups,seenGroups=crossfilter_index(oldK,oldK);for(var i=0,j=0;i<n;++i){if(!filters.zero(i)){seenGroups[groupIndex[j]=groupIndex[i]]=1;++j}}groups=[],k=0;for(i=0;i<oldK;++i){if(seenGroups[i]){seenGroups[i]=k++;groups.push(oldGroups[i])}}if(k>1){for(var i=0;i<j;++i)groupIndex[i]=seenGroups[groupIndex[i]]}else{groupIndex=null}filterListeners[filterListeners.indexOf(update)]=k>1?(reset=resetMany,update=updateMany):k===1?(reset=resetOne,update=updateOne):reset=update=crossfilter_null}else if(k===1){if(groupAll)return;for(var i=0;i<n;++i)if(!filters.zero(i))return;groups=[],k=0;filterListeners[filterListeners.indexOf(update)]=update=reset=crossfilter_null}}function updateMany(filterOne,filterOffset,added,removed,notFilter){if(filterOne===one&&filterOffset===offset||resetNeeded)return;var i,j,k,n,g;if(iterable){for(i=0,n=added.length;i<n;++i){if(filters.zeroExcept(k=added[i],offset,zero)){for(j=0;j<groupIndex[k].length;j++){g=groups[groupIndex[k][j]];g.value=reduceAdd(g.value,data[k],false,j)}}}for(i=0,n=removed.length;i<n;++i){if(filters.onlyExcept(k=removed[i],offset,zero,filterOffset,filterOne)){for(j=0;j<groupIndex[k].length;j++){g=groups[groupIndex[k][j]];g.value=reduceRemove(g.value,data[k],notFilter,j)}}}return}for(i=0,n=added.length;i<n;++i){if(filters.zeroExcept(k=added[i],offset,zero)){g=groups[groupIndex[k]];g.value=reduceAdd(g.value,data[k],false)}}for(i=0,n=removed.length;i<n;++i){if(filters.onlyExcept(k=removed[i],offset,zero,filterOffset,filterOne)){g=groups[groupIndex[k]];g.value=reduceRemove(g.value,data[k],notFilter)}}}function updateOne(filterOne,filterOffset,added,removed,notFilter){if(filterOne===one&&filterOffset===offset||resetNeeded)return;var i,k,n,g=groups[0];for(i=0,n=added.length;i<n;++i){if(filters.zeroExcept(k=added[i],offset,zero)){g.value=reduceAdd(g.value,data[k],false)}}for(i=0,n=removed.length;i<n;++i){if(filters.onlyExcept(k=removed[i],offset,zero,filterOffset,filterOne)){g.value=reduceRemove(g.value,data[k],notFilter)}}}function resetMany(){var i,j,g;for(i=0;i<k;++i){groups[i].value=reduceInitial()}if(iterable){for(i=0;i<n;++i){for(j=0;j<groupIndex[i].length;j++){g=groups[groupIndex[i][j]];g.value=reduceAdd(g.value,data[i],true,j)}}for(i=0;i<n;++i){if(!filters.zeroExcept(i,offset,zero)){for(j=0;j<groupIndex[i].length;j++){g=groups[groupIndex[i][j]];g.value=reduceRemove(g.value,data[i],false,j)}}}return}for(i=0;i<n;++i){g=groups[groupIndex[i]];g.value=reduceAdd(g.value,data[i],true)}for(i=0;i<n;++i){if(!filters.zeroExcept(i,offset,zero)){g=groups[groupIndex[i]];g.value=reduceRemove(g.value,data[i],false)}}}function resetOne(){var i,g=groups[0];g.value=reduceInitial();for(i=0;i<n;++i){g.value=reduceAdd(g.value,data[i],true)}for(i=0;i<n;++i){if(!filters.zeroExcept(i,offset,zero)){g.value=reduceRemove(g.value,data[i],false)}}}function all(){if(resetNeeded)reset(),resetNeeded=false;return groups}function top(k){var top=select(all(),0,groups.length,k);return heap.sort(top,0,top.length)}function reduce(add,remove,initial){reduceAdd=add;reduceRemove=remove;reduceInitial=initial;resetNeeded=true;return group}function reduceCount(){return reduce(xfilterReduce.reduceIncrement,xfilterReduce.reduceDecrement,crossfilter_zero)}function reduceSum(value){return reduce(xfilterReduce.reduceAdd(value),xfilterReduce.reduceSubtract(value),crossfilter_zero)}function order(value){select=xfilterHeapselect.by(valueOf);heap=xfilterHeap.by(valueOf);function valueOf(d){return value(d.value)}return group}function orderNatural(){return order(crossfilter_identity)}function size(){return k}function dispose(){var i=filterListeners.indexOf(update);if(i>=0)filterListeners.splice(i,1);i=indexListeners.indexOf(add);if(i>=0)indexListeners.splice(i,1);i=removeDataListeners.indexOf(removeData);if(i>=0)removeDataListeners.splice(i,1);return group}return reduceCount().orderNatural()}function groupAll(){var g=group(crossfilter_null),all=g.all;delete g.all;delete g.top;delete g.order;delete g.orderNatural;delete g.size;g.value=function(){return all()[0].value};return g}function dispose(){dimensionGroups.forEach(function(group){group.dispose()});var i=dataListeners.indexOf(preAdd);if(i>=0)dataListeners.splice(i,1);i=dataListeners.indexOf(postAdd);if(i>=0)dataListeners.splice(i,1);i=removeDataListeners.indexOf(removeData);if(i>=0)removeDataListeners.splice(i,1);filters.masks[offset]&=zero;return filterAll()}return dimension}function groupAll(){var group={reduce:reduce,reduceCount:reduceCount,reduceSum:reduceSum,value:value,dispose:dispose,remove:dispose};var reduceValue,reduceAdd,reduceRemove,reduceInitial,resetNeeded=true;filterListeners.push(update);dataListeners.push(add);add(data,0,n);function add(newData,n0){var i;if(resetNeeded)return;for(i=n0;i<n;++i){reduceValue=reduceAdd(reduceValue,data[i],true);if(!filters.zero(i)){reduceValue=reduceRemove(reduceValue,data[i],false)}}}function update(filterOne,filterOffset,added,removed,notFilter){var i,k,n;if(resetNeeded)return;for(i=0,n=added.length;i<n;++i){if(filters.zero(k=added[i])){reduceValue=reduceAdd(reduceValue,data[k],notFilter)}}for(i=0,n=removed.length;i<n;++i){if(filters.only(k=removed[i],filterOffset,filterOne)){reduceValue=reduceRemove(reduceValue,data[k],notFilter)}}}function reset(){var i;reduceValue=reduceInitial();for(i=0;i<n;++i){reduceValue=reduceAdd(reduceValue,data[i],true);if(!filters.zero(i)){reduceValue=reduceRemove(reduceValue,data[i],false)}}}function reduce(add,remove,initial){reduceAdd=add;reduceRemove=remove;reduceInitial=initial;resetNeeded=true;return group}function reduceCount(){return reduce(xfilterReduce.reduceIncrement,xfilterReduce.reduceDecrement,crossfilter_zero)}function reduceSum(value){return reduce(xfilterReduce.reduceAdd(value),xfilterReduce.reduceSubtract(value),crossfilter_zero)}function value(){if(resetNeeded)reset(),resetNeeded=false;return reduceValue}function dispose(){var i=filterListeners.indexOf(update);if(i>=0)filterListeners.splice(i);i=dataListeners.indexOf(add);if(i>=0)dataListeners.splice(i);return group}return reduceCount()}function size(){return n}function all(){return data}function onChange(cb){if(typeof cb!=="function"){console.warn("onChange callback parameter must be a function!");return}callbacks.push(cb);return function(){callbacks.splice(callbacks.indexOf(cb),1)}}function triggerOnChange(eventName){for(var i=0;i<callbacks.length;i++){callbacks[i](eventName)}}return arguments.length?add(arguments[0]):crossfilter}function crossfilter_index(n,m){return(m<257?xfilterArray.array8:m<65537?xfilterArray.array16:xfilterArray.array32)(n)}function crossfilter_range(n){var range=crossfilter_index(n,n);for(var i=-1;++i<n;)range[i]=i;return range}function crossfilter_capacity(w){return w===8?256:w===16?65536:4294967296}},{"./../package.json":2,"./array":3,"./bisect":4,"./filter":6,"./heap":7,"./heapselect":8,"./identity":9,"./insertionsort":10,"./null":11,"./permute":12,"./quicksort":13,"./reduce":14,"./zero":15,"lodash.result":16}],6:[function(require,module,exports){function crossfilter_filterExact(bisect,value){return function(values){var n=values.length;return[bisect.left(values,value,0,n),bisect.right(values,value,0,n)]}}function crossfilter_filterRange(bisect,range){var min=range[0],max=range[1];return function(values){var n=values.length;return[bisect.left(values,min,0,n),bisect.left(values,max,0,n)]}}function crossfilter_filterAll(values){return[0,values.length]}module.exports={filterExact:crossfilter_filterExact,filterRange:crossfilter_filterRange,filterAll:crossfilter_filterAll}},{}],7:[function(require,module,exports){var crossfilter_identity=require("./identity");function heap_by(f){function heap(a,lo,hi){var n=hi-lo,i=(n>>>1)+1;while(--i>0)sift(a,i,n,lo);return a}function sort(a,lo,hi){var n=hi-lo,t;while(--n>0)t=a[lo],a[lo]=a[lo+n],a[lo+n]=t,sift(a,1,n,lo);return a}function sift(a,i,n,lo){var d=a[--lo+i],x=f(d),child;while((child=i<<1)<=n){if(child<n&&f(a[lo+child])>f(a[lo+child+1]))child++;if(x<=f(a[lo+child]))break;a[lo+i]=a[lo+child];i=child}a[lo+i]=d}heap.sort=sort;return heap}module.exports=heap_by(crossfilter_identity);module.exports.by=heap_by},{"./identity":9}],8:[function(require,module,exports){var crossfilter_identity=require("./identity");var xFilterHeap=require("./heap");function heapselect_by(f){var heap=xFilterHeap.by(f);function heapselect(a,lo,hi,k){var queue=new Array(k=Math.min(hi-lo,k)),min,i,x,d;for(i=0;i<k;++i)queue[i]=a[lo++];heap(queue,0,k);if(lo<hi){min=f(queue[0]);do{if(x=f(d=a[lo])>min){queue[0]=d;min=f(heap(queue,0,k)[0])}}while(++lo<hi)}return queue}return heapselect}module.exports=heapselect_by(crossfilter_identity);module.exports.by=heapselect_by},{"./heap":7,"./identity":9}],9:[function(require,module,exports){function crossfilter_identity(d){return d}module.exports=crossfilter_identity},{}],10:[function(require,module,exports){var crossfilter_identity=require("./identity");function insertionsort_by(f){function insertionsort(a,lo,hi){for(var i=lo+1;i<hi;++i){for(var j=i,t=a[i],x=f(t);j>lo&&f(a[j-1])>x;--j){a[j]=a[j-1]}a[j]=t}return a}return insertionsort}module.exports=insertionsort_by(crossfilter_identity);module.exports.by=insertionsort_by},{"./identity":9}],11:[function(require,module,exports){function crossfilter_null(){return null}module.exports=crossfilter_null},{}],12:[function(require,module,exports){function permute(array,index,deep){for(var i=0,n=index.length,copy=deep?JSON.parse(JSON.stringify(array)):new Array(n);i<n;++i){copy[i]=array[index[i]]}return copy}module.exports=permute},{}],13:[function(require,module,exports){var crossfilter_identity=require("./identity");var xFilterInsertionsort=require("./insertionsort");function quicksort_by(f){var insertionsort=xFilterInsertionsort.by(f);function sort(a,lo,hi){return(hi-lo<quicksort_sizeThreshold?insertionsort:quicksort)(a,lo,hi)}function quicksort(a,lo,hi){var sixth=(hi-lo)/6|0,i1=lo+sixth,i5=hi-1-sixth,i3=lo+hi-1>>1,i2=i3-sixth,i4=i3+sixth;var e1=a[i1],x1=f(e1),e2=a[i2],x2=f(e2),e3=a[i3],x3=f(e3),e4=a[i4],x4=f(e4),e5=a[i5],x5=f(e5);var t;if(x1>x2)t=e1,e1=e2,e2=t,t=x1,x1=x2,x2=t;if(x4>x5)t=e4,e4=e5,e5=t,t=x4,x4=x5,x5=t;if(x1>x3)t=e1,e1=e3,e3=t,t=x1,x1=x3,x3=t;if(x2>x3)t=e2,e2=e3,e3=t,t=x2,x2=x3,x3=t;if(x1>x4)t=e1,e1=e4,e4=t,t=x1,x1=x4,x4=t;if(x3>x4)t=e3,e3=e4,e4=t,t=x3,x3=x4,x4=t;if(x2>x5)t=e2,e2=e5,e5=t,t=x2,x2=x5,x5=t;if(x2>x3)t=e2,e2=e3,e3=t,t=x2,x2=x3,x3=t;if(x4>x5)t=e4,e4=e5,e5=t,t=x4,x4=x5,x5=t;var pivot1=e2,pivotValue1=x2,pivot2=e4,pivotValue2=x4;a[i1]=e1;a[i2]=a[lo];a[i3]=e3;a[i4]=a[hi-1];a[i5]=e5;var less=lo+1,great=hi-2;var pivotsEqual=pivotValue1<=pivotValue2&&pivotValue1>=pivotValue2;if(pivotsEqual){for(var k=less;k<=great;++k){var ek=a[k],xk=f(ek);if(xk<pivotValue1){if(k!==less){a[k]=a[less];a[less]=ek}++less}else if(xk>pivotValue1){while(true){var greatValue=f(a[great]);if(greatValue>pivotValue1){great--;continue}else if(greatValue<pivotValue1){a[k]=a[less];a[less++]=a[great];a[great--]=ek;break}else{a[k]=a[great];a[great--]=ek;break}}}}}else{for(var k=less;k<=great;k++){var ek=a[k],xk=f(ek);if(xk<pivotValue1){if(k!==less){a[k]=a[less];a[less]=ek}++less}else{if(xk>pivotValue2){while(true){var greatValue=f(a[great]);if(greatValue>pivotValue2){great--;if(great<k)break;continue}else{if(greatValue<pivotValue1){a[k]=a[less];a[less++]=a[great];a[great--]=ek}else{a[k]=a[great];a[great--]=ek}break}}}}}}a[lo]=a[less-1];a[less-1]=pivot1;a[hi-1]=a[great+1];a[great+1]=pivot2;sort(a,lo,less-1);sort(a,great+2,hi);if(pivotsEqual){return a}if(less<i1&&great>i5){
var lessValue,greatValue;while((lessValue=f(a[less]))<=pivotValue1&&lessValue>=pivotValue1)++less;while((greatValue=f(a[great]))<=pivotValue2&&greatValue>=pivotValue2)--great;for(var k=less;k<=great;k++){var ek=a[k],xk=f(ek);if(xk<=pivotValue1&&xk>=pivotValue1){if(k!==less){a[k]=a[less];a[less]=ek}less++}else{if(xk<=pivotValue2&&xk>=pivotValue2){while(true){var greatValue=f(a[great]);if(greatValue<=pivotValue2&&greatValue>=pivotValue2){great--;if(great<k)break;continue}else{if(greatValue<pivotValue1){a[k]=a[less];a[less++]=a[great];a[great--]=ek}else{a[k]=a[great];a[great--]=ek}break}}}}}}return sort(a,less,great+1)}return sort}var quicksort_sizeThreshold=32;module.exports=quicksort_by(crossfilter_identity);module.exports.by=quicksort_by},{"./identity":9,"./insertionsort":10}],14:[function(require,module,exports){function crossfilter_reduceIncrement(p){return p+1}function crossfilter_reduceDecrement(p){return p-1}function crossfilter_reduceAdd(f){return function(p,v){return p+ +f(v)}}function crossfilter_reduceSubtract(f){return function(p,v){return p-f(v)}}module.exports={reduceIncrement:crossfilter_reduceIncrement,reduceDecrement:crossfilter_reduceDecrement,reduceAdd:crossfilter_reduceAdd,reduceSubtract:crossfilter_reduceSubtract}},{}],15:[function(require,module,exports){function crossfilter_zero(){return 0}module.exports=crossfilter_zero},{}],16:[function(require,module,exports){(function(global){var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0;var funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol=root.Symbol,splice=arrayProto.splice;var Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create");var symbolProto=Symbol?Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray(value)?value:stringToPath(value)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}var isArray=Array.isArray;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString(value){return value==null?"":baseToString(value)}function result(object,path,defaultValue){path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length;if(!length){object=undefined;length=1}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}module.exports=result}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],17:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],18:[function(require,module,exports){(function(process){(function(definition){"use strict";if(typeof bootstrap==="function"){bootstrap("promise",definition)}else if(typeof exports==="object"&&typeof module==="object"){module.exports=definition()}else if(typeof define==="function"&&define.amd){define(definition)}else if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=definition}}else if(typeof window!=="undefined"||typeof self!=="undefined"){var global=typeof window!=="undefined"?window:self;var previousQ=global.Q;global.Q=definition();global.Q.noConflict=function(){global.Q=previousQ;return this}}else{throw new Error("This environment was not anticipated by Q. Please file a bug.")}})(function(){"use strict";var hasStacks=false;try{throw new Error}catch(e){hasStacks=!!e.stack}var qStartingLine=captureLine();var qFileName;var noop=function(){};var nextTick=function(){var head={task:void 0,next:null};var tail=head;var flushing=false;var requestTick=void 0;var isNodeJS=false;var laterQueue=[];function flush(){var task,domain;while(head.next){head=head.next;task=head.task;head.task=void 0;domain=head.domain;if(domain){head.domain=void 0;domain.enter()}runSingle(task,domain)}while(laterQueue.length){task=laterQueue.pop();runSingle(task)}flushing=false}function runSingle(task,domain){try{task()}catch(e){if(isNodeJS){if(domain){domain.exit()}setTimeout(flush,0);if(domain){domain.enter()}throw e}else{setTimeout(function(){throw e},0)}}if(domain){domain.exit()}}nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null};if(!flushing){flushing=true;requestTick()}};if(typeof process==="object"&&process.toString()==="[object process]"&&process.nextTick){isNodeJS=true;requestTick=function(){process.nextTick(flush)}}else if(typeof setImmediate==="function"){if(typeof window!=="undefined"){requestTick=setImmediate.bind(window,flush)}else{requestTick=function(){setImmediate(flush)}}}else if(typeof MessageChannel!=="undefined"){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick;channel.port1.onmessage=flush;flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0);requestPortTick()}}else{requestTick=function(){setTimeout(flush,0)}}nextTick.runAfter=function(task){laterQueue.push(task);if(!flushing){flushing=true;requestTick()}};return nextTick}();var call=Function.call;function uncurryThis(f){return function(){return call.apply(f,arguments)}}var array_slice=uncurryThis(Array.prototype.slice);var array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(arguments.length===1){do{if(index in this){basis=this[index++];break}if(++index>=length){throw new TypeError}}while(1)}for(;index<length;index++){if(index in this){basis=callback(basis,this[index],index)}}return basis});var array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++){if(this[i]===value){return i}}return-1});var array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this;var collect=[];array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0);return collect});var object_create=Object.create||function(prototype){function Type(){}Type.prototype=prototype;return new Type};var object_defineProperty=Object.defineProperty||function(obj,prop,descriptor){obj[prop]=descriptor.value;return obj};var object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty);var object_keys=Object.keys||function(object){var keys=[];for(var key in object){if(object_hasOwnProperty(object,key)){keys.push(key)}}return keys};var object_toString=uncurryThis(Object.prototype.toString);function isObject(value){return value===Object(value)}function isStopIteration(exception){return object_toString(exception)==="[object StopIteration]"||exception instanceof QReturnValue}var QReturnValue;if(typeof ReturnValue!=="undefined"){QReturnValue=ReturnValue}else{QReturnValue=function(value){this.value=value}}var STACK_JUMP_SEPARATOR="From previous event:";function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&typeof error==="object"&&error!==null&&error.stack){var stacks=[];for(var p=promise;!!p;p=p.source){if(p.stack&&(!error.__minimumStackCounter__||error.__minimumStackCounter__>p.stackCounter)){object_defineProperty(error,"__minimumStackCounter__",{value:p.stackCounter,configurable:true});stacks.unshift(p.stack)}}stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");var stack=filterStackString(concatedStacks);object_defineProperty(error,"stack",{value:stack,configurable:true})}}function filterStackString(stackString){var lines=stackString.split("\n");var desiredLines=[];for(var i=0;i<lines.length;++i){var line=lines[i];if(!isInternalFrame(line)&&!isNodeFrame(line)&&line){desiredLines.push(line)}}return desiredLines.join("\n")}function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1){return[attempt1[1],Number(attempt1[2])]}var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2){return[attempt2[1],Number(attempt2[2])]}var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);if(attempt3){return[attempt3[1],Number(attempt3[2])]}}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber){return false}var fileName=fileNameAndLineNumber[0];var lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&lineNumber<=qEndingLine}function captureLine(){if(!hasStacks){return}try{throw new Error}catch(e){var lines=e.stack.split("\n");var firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2];var fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber){return}qFileName=fileNameAndLineNumber[0];return fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack)}return callback.apply(callback,arguments)}}function Q(value){if(value instanceof Promise){return value}if(isPromiseAlike(value)){return coerce(value)}else{return fulfill(value)}}Q.resolve=Q;Q.nextTick=nextTick;Q.longStackSupport=false;var longStackCounter=1;if(typeof process==="object"&&process&&process.env&&process.env.Q_DEBUG){Q.longStackSupport=true}Q.defer=defer;function defer(){var messages=[],progressListeners=[],resolvedPromise;var deferred=object_create(defer.prototype);var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);if(messages){messages.push(args);if(op==="when"&&operands[1]){progressListeners.push(operands[1])}}else{Q.nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})}};promise.valueOf=function(){if(messages){return promise}var nearerValue=nearer(resolvedPromise);if(isPromise(nearerValue)){resolvedPromise=nearerValue}return nearerValue};promise.inspect=function(){if(!resolvedPromise){return{state:"pending"}}return resolvedPromise.inspect()};if(Q.longStackSupport&&hasStacks){try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1);promise.stackCounter=longStackCounter++}}function become(newPromise){resolvedPromise=newPromise;if(Q.longStackSupport&&hasStacks){promise.source=newPromise}array_reduce(messages,function(undefined,message){Q.nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0);messages=void 0;progressListeners=void 0}deferred.promise=promise;deferred.resolve=function(value){if(resolvedPromise){return}become(Q(value))};deferred.fulfill=function(value){if(resolvedPromise){return}become(fulfill(value))};deferred.reject=function(reason){if(resolvedPromise){return}become(reject(reason))};deferred.notify=function(progress){if(resolvedPromise){return}array_reduce(progressListeners,function(undefined,progressListener){Q.nextTick(function(){progressListener(progress)})},void 0)};return deferred}defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){if(error){self.reject(error)}else if(arguments.length>2){self.resolve(array_slice(arguments,1))}else{self.resolve(value)}}};Q.Promise=promise;Q.promise=promise;function promise(resolver){if(typeof resolver!=="function"){throw new TypeError("resolver must be a function.")}var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}promise.race=race;promise.all=all;promise.reject=reject;promise.resolve=Q;Q.passByCopy=function(object){return object};Promise.prototype.passByCopy=function(){return this};Q.join=function(x,y){return Q(x).join(y)};Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y){return x}else{throw new Error("Q can't join: not the same: "+x+" "+y)}})};Q.race=race;function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;i<len;i++){Q(answerPs[i]).then(resolve,reject)}})}Promise.prototype.race=function(){return this.then(Q.race)};Q.makePromise=Promise;function Promise(descriptor,fallback,inspect){if(fallback===void 0){fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}}if(inspect===void 0){inspect=function(){return{state:"unknown"}}}var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,args){var result;try{if(descriptor[op]){result=descriptor[op].apply(promise,args)}else{result=fallback.call(promise,op,args)}}catch(exception){result=reject(exception)}if(resolve){resolve(result)}};promise.inspect=inspect;if(inspect){var inspected=inspect();if(inspected.state==="rejected"){promise.exception=inspected.reason}promise.valueOf=function(){var inspected=inspect();if(inspected.state==="pending"||inspected.state==="rejected"){return promise}return inspected.value}}return promise}Promise.prototype.toString=function(){return"[object Promise]"};Promise.prototype.then=function(fulfilled,rejected,progressed){var self=this;var deferred=defer();var done=false;function _fulfilled(value){try{return typeof fulfilled==="function"?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if(typeof rejected==="function"){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return typeof progressed==="function"?progressed(value):value}Q.nextTick(function(){self.promiseDispatch(function(value){if(done){return}done=true;deferred.resolve(_fulfilled(value))},"when",[function(exception){if(done){return}done=true;deferred.resolve(_rejected(exception))}])});self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue;var threw=false;try{newValue=_progressed(value)}catch(e){threw=true;if(Q.onerror){Q.onerror(e)}else{throw e}}if(!threw){deferred.notify(newValue)}}]);return deferred.promise};Q.tap=function(promise,callback){return Q(promise).tap(callback)};Promise.prototype.tap=function(callback){callback=Q(callback);return this.then(function(value){return callback.fcall(value).thenResolve(value)})};Q.when=when;function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}Promise.prototype.thenResolve=function(value){return this.then(function(){return value})};Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)};Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})};Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)};Q.nearer=nearer;function nearer(value){if(isPromise(value)){var inspected=value.inspect();if(inspected.state==="fulfilled"){return inspected.value}}return value}Q.isPromise=isPromise;function isPromise(object){return object instanceof Promise}Q.isPromiseAlike=isPromiseAlike;function isPromiseAlike(object){return isObject(object)&&typeof object.then==="function"}Q.isPending=isPending;function isPending(object){return isPromise(object)&&object.inspect().state==="pending"}Promise.prototype.isPending=function(){return this.inspect().state==="pending"};Q.isFulfilled=isFulfilled;function isFulfilled(object){return!isPromise(object)||object.inspect().state==="fulfilled"}Promise.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};Q.isRejected=isRejected;function isRejected(object){return isPromise(object)&&object.inspect().state==="rejected"}Promise.prototype.isRejected=function(){return this.inspect().state==="rejected"};var unhandledReasons=[];var unhandledRejections=[];var reportedUnhandledRejections=[];var trackUnhandledRejections=true;function resetUnhandledRejections(){unhandledReasons.length=0;unhandledRejections.length=0;if(!trackUnhandledRejections){trackUnhandledRejections=true}}function trackRejection(promise,reason){if(!trackUnhandledRejections){return}if(typeof process==="object"&&typeof process.emit==="function"){Q.nextTick.runAfter(function(){if(array_indexOf(unhandledRejections,promise)!==-1){process.emit("unhandledRejection",reason,promise);reportedUnhandledRejections.push(promise)}})}unhandledRejections.push(promise);if(reason&&typeof reason.stack!=="undefined"){unhandledReasons.push(reason.stack)}else{unhandledReasons.push("(no stack) "+reason)}}function untrackRejection(promise){if(!trackUnhandledRejections){return}var at=array_indexOf(unhandledRejections,promise);if(at!==-1){if(typeof process==="object"&&typeof process.emit==="function"){Q.nextTick.runAfter(function(){var atReport=array_indexOf(reportedUnhandledRejections,promise);if(atReport!==-1){process.emit("rejectionHandled",unhandledReasons[at],promise);reportedUnhandledRejections.splice(atReport,1)}})}unhandledRejections.splice(at,1);unhandledReasons.splice(at,1)}}Q.resetUnhandledRejections=resetUnhandledRejections;Q.getUnhandledReasons=function(){return unhandledReasons.slice()};Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections();trackUnhandledRejections=false};resetUnhandledRejections();Q.reject=reject;function reject(reason){var rejection=Promise({when:function(rejected){if(rejected){untrackRejection(this)}return rejected?rejected(reason):this}},function fallback(){return this},function inspect(){return{state:"rejected",reason:reason}});trackRejection(rejection,reason);return rejection}Q.fulfill=fulfill;function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},delete:function(name){delete value[name]},post:function(name,args){if(name===null||name===void 0){return value.apply(void 0,args)}else{return value[name].apply(value,args)}},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function inspect(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();Q.nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}});return deferred.promise}Q.master=master;function master(object){return Promise({isDef:function(){}},function fallback(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}Q.spread=spread;function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)};Q.async=async;function async(makeGenerator){return function(){function continuer(verb,arg){var result;if(typeof StopIteration==="undefined"){try{result=generator[verb](arg)}catch(exception){return reject(exception)}if(result.done){return Q(result.value)}else{return when(result.value,callback,errback)}}else{try{result=generator[verb](arg)}catch(exception){if(isStopIteration(exception)){return Q(exception.value)}else{return reject(exception)}}return when(result,callback,errback)}}var generator=makeGenerator.apply(this,arguments);var callback=continuer.bind(continuer,"next");var errback=continuer.bind(continuer,"throw");return callback()}}Q.spawn=spawn;function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}Q["return"]=_return;function _return(value){throw new QReturnValue(value)}Q.promised=promised;function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}Q.dispatch=dispatch;function dispatch(object,op,args){return Q(object).dispatch(op,args)}Promise.prototype.dispatch=function(op,args){var self=this;var deferred=defer();Q.nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)});return deferred.promise};Q.get=function(object,key){return Q(object).dispatch("get",[key])};Promise.prototype.get=function(key){return this.dispatch("get",[key])};Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])};Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])};Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])};Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])};Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])};Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])};Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])};Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])};Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])};Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])};Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])};Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])};Q.fbind=function(object){var promise=Q(object);var args=array_slice(arguments,1);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}};Promise.prototype.fbind=function(){var promise=this;var args=array_slice(arguments);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}};Q.keys=function(object){return Q(object).dispatch("keys",[])};Promise.prototype.keys=function(){return this.dispatch("keys",[])};Q.all=all;function all(promises){return when(promises,function(promises){var pendingCount=0;var deferred=defer();array_reduce(promises,function(undefined,promise,index){var snapshot;if(isPromise(promise)&&(snapshot=promise.inspect()).state==="fulfilled"){promises[index]=snapshot.value}else{++pendingCount;when(promise,function(value){promises[index]=value;if(--pendingCount===0){deferred.resolve(promises)}},deferred.reject,function(progress){deferred.notify({index:index,value:progress})})}},void 0);if(pendingCount===0){deferred.resolve(promises)}return deferred.promise})}Promise.prototype.all=function(){return all(this)};Q.any=any;function any(promises){if(promises.length===0){return Q.resolve()}var deferred=Q.defer();var pendingCount=0;array_reduce(promises,function(prev,current,index){var promise=promises[index];pendingCount++;when(promise,onFulfilled,onRejected,onProgress);function onFulfilled(result){deferred.resolve(result)}function onRejected(err){pendingCount--;if(pendingCount===0){
err.message="Q can't get fulfillment value from any promise, all "+"promises were rejected. Last error message: "+err.message;deferred.reject(err)}}function onProgress(progress){deferred.notify({index:index,value:progress})}},undefined);return deferred.promise}Promise.prototype.any=function(){return any(this)};Q.allResolved=deprecate(allResolved,"allResolved","allSettled");function allResolved(promises){return when(promises,function(promises){promises=array_map(promises,Q);return when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}Promise.prototype.allResolved=function(){return allResolved(this)};Q.allSettled=allSettled;function allSettled(promises){return Q(promises).allSettled()}Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){promise=Q(promise);function regardless(){return promise.inspect()}return promise.then(regardless,regardless)}))})};Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)};Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)};Q.progress=progress;function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)};Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)};Promise.prototype.fin=Promise.prototype["finally"]=function(callback){if(!callback||typeof callback.apply!=="function"){throw new Error("Q can't apply finally callback")}callback=Q(callback);return this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})};Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)};Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){Q.nextTick(function(){makeStackTraceLong(error,promise);if(Q.onerror){Q.onerror(error)}else{throw error}})};var promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;if(typeof process==="object"&&process&&process.domain){onUnhandledError=process.domain.bind(onUnhandledError)}promise.then(void 0,onUnhandledError)};Q.timeout=function(object,ms,error){return Q(object).timeout(ms,error)};Promise.prototype.timeout=function(ms,error){var deferred=defer();var timeoutId=setTimeout(function(){if(!error||"string"===typeof error){error=new Error(error||"Timed out after "+ms+" ms");error.code="ETIMEDOUT"}deferred.reject(error)},ms);this.then(function(value){clearTimeout(timeoutId);deferred.resolve(value)},function(exception){clearTimeout(timeoutId);deferred.reject(exception)},deferred.notify);return deferred.promise};Q.delay=function(object,timeout){if(timeout===void 0){timeout=object;object=void 0}return Q(object).delay(timeout)};Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();setTimeout(function(){deferred.resolve(value)},timeout);return deferred.promise})};Q.nfapply=function(callback,args){return Q(callback).nfapply(args)};Promise.prototype.nfapply=function(args){var deferred=defer();var nodeArgs=array_slice(args);nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise};Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)};Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise};Q.nfbind=Q.denodeify=function(callback){if(callback===undefined){throw new Error("Q can't wrap an undefined function")}var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());Q(callback).fapply(nodeArgs).fail(deferred.reject);return deferred.promise}};Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);args.unshift(this);return Q.denodeify.apply(void 0,args)};Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());function bound(){return callback.apply(thisp,arguments)}Q(bound).fapply(nodeArgs).fail(deferred.reject);return deferred.promise}};Promise.prototype.nbind=function(){var args=array_slice(arguments,0);args.unshift(this);return Q.nbind.apply(void 0,args)};Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)};Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Q.nodeify=nodeify;function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}Promise.prototype.nodeify=function(nodeback){if(nodeback){this.then(function(value){Q.nextTick(function(){nodeback(null,value)})},function(error){Q.nextTick(function(){nodeback(error)})})}else{return this}};Q.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var qEndingLine=captureLine();return Q})}).call(this,require("_process"))},{_process:17}],19:[function(require,module,exports){var reductio_parameters=require("./parameters.js");_assign=function assign(target){if(target==null){throw new TypeError("Cannot convert undefined or null to object")}var output=Object(target);for(var index=1;index<arguments.length;++index){var source=arguments[index];if(source!=null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey]}}}}return output};function accessor_build(obj,p){function accessorify(v){if(typeof v==="string"){var tempValue=v;var func=function(d){return d[tempValue]};return func}else{return v}}function accessorifyNumeric(v){if(typeof v==="string"){var tempValue=v;var func=function(d){return+d[tempValue]};return func}else{return v}}obj.fromObject=function(value){if(!arguments.length)return p;_assign(p,value);return obj};obj.toObject=function(){return p};obj.count=function(value,propName){if(!arguments.length)return p.count;if(!propName){propName="count"}p.count=propName;return obj};obj.sum=function(value){if(!arguments.length)return p.sum;value=accessorifyNumeric(value);p.sum=value;return obj};obj.avg=function(value){if(!arguments.length)return p.avg;value=accessorifyNumeric(value);if(typeof value==="function"){if(p.sum&&p.sum!==value)console.warn("SUM aggregation is being overwritten by AVG aggregation");p.sum=value;p.avg=true;p.count="count"}else{p.avg=value}return obj};obj.exception=function(value){if(!arguments.length)return p.exceptionAccessor;value=accessorify(value);p.exceptionAccessor=value;return obj};obj.filter=function(value){if(!arguments.length)return p.filter;p.filter=value;return obj};obj.valueList=function(value){if(!arguments.length)return p.valueList;value=accessorify(value);p.valueList=value;return obj};obj.median=function(value){if(!arguments.length)return p.median;value=accessorifyNumeric(value);if(typeof value==="function"){if(p.valueList&&p.valueList!==value)console.warn("VALUELIST accessor is being overwritten by median aggregation");p.valueList=value}p.median=value;return obj};obj.min=function(value){if(!arguments.length)return p.min;value=accessorifyNumeric(value);if(typeof value==="function"){if(p.valueList&&p.valueList!==value)console.warn("VALUELIST accessor is being overwritten by min aggregation");p.valueList=value}p.min=value;return obj};obj.max=function(value){if(!arguments.length)return p.max;value=accessorifyNumeric(value);if(typeof value==="function"){if(p.valueList&&p.valueList!==value)console.warn("VALUELIST accessor is being overwritten by max aggregation");p.valueList=value}p.max=value;return obj};obj.exceptionCount=function(value){if(!arguments.length)return p.exceptionCount;value=accessorify(value);if(typeof value==="function"){if(p.exceptionAccessor&&p.exceptionAccessor!==value)console.warn("EXCEPTION accessor is being overwritten by exception count aggregation");p.exceptionAccessor=value;p.exceptionCount=true}else{p.exceptionCount=value}return obj};obj.exceptionSum=function(value){if(!arguments.length)return p.exceptionSum;value=accessorifyNumeric(value);p.exceptionSum=value;return obj};obj.histogramValue=function(value){if(!arguments.length)return p.histogramValue;value=accessorifyNumeric(value);p.histogramValue=value;return obj};obj.histogramBins=function(value){if(!arguments.length)return p.histogramThresholds;p.histogramThresholds=value;return obj};obj.std=function(value){if(!arguments.length)return p.std;value=accessorifyNumeric(value);if(typeof value==="function"){p.sumOfSquares=value;p.sum=value;p.count="count";p.std=true}else{p.std=value}return obj};obj.sumOfSq=function(value){if(!arguments.length)return p.sumOfSquares;value=accessorifyNumeric(value);p.sumOfSquares=value;return obj};obj.value=function(value,accessor){if(!arguments.length||typeof value!=="string"){console.error("'value' requires a string argument.")}else{if(!p.values)p.values={};p.values[value]={};p.values[value].parameters=reductio_parameters();accessor_build(p.values[value],p.values[value].parameters);if(accessor)p.values[value].accessor=accessor;return p.values[value]}};obj.nest=function(keyAccessorArray){if(!arguments.length)return p.nestKeys;keyAccessorArray.map(accessorify);p.nestKeys=keyAccessorArray;return obj};obj.alias=function(propAccessorObj){if(!arguments.length)return p.aliasKeys;p.aliasKeys=propAccessorObj;return obj};obj.aliasProp=function(propAccessorObj){if(!arguments.length)return p.aliasPropKeys;p.aliasPropKeys=propAccessorObj;return obj};obj.groupAll=function(groupTest){if(!arguments.length)return p.groupAll;p.groupAll=groupTest;return obj};obj.dataList=function(value){if(!arguments.length)return p.dataList;p.dataList=value;return obj};obj.custom=function(addRemoveInitialObj){if(!arguments.length)return p.custom;p.custom=addRemoveInitialObj;return obj}}var reductio_accessors={build:accessor_build};module.exports=reductio_accessors},{"./parameters.js":36}],20:[function(require,module,exports){var reductio_alias={initial:function(prior,path,obj){return function(p){if(prior)p=prior(p);function buildAliasFunction(key){return function(){return obj[key](path(p))}}for(var prop in obj){path(p)[prop]=buildAliasFunction(prop)}return p}}};module.exports=reductio_alias},{}],21:[function(require,module,exports){var reductio_alias_prop={add:function(obj,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);for(var prop in obj){path(p)[prop]=obj[prop](path(p),v)}return p}}};module.exports=reductio_alias_prop},{}],22:[function(require,module,exports){var reductio_avg={add:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);if(path(p).count>0){path(p).avg=path(p).sum/path(p).count}else{path(p).avg=0}return p}},remove:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);if(path(p).count>0){path(p).avg=path(p).sum/path(p).count}else{path(p).avg=0}return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).avg=0;return p}}};module.exports=reductio_avg},{}],23:[function(require,module,exports){var reductio_filter=require("./filter.js");var reductio_count=require("./count.js");var reductio_sum=require("./sum.js");var reductio_avg=require("./avg.js");var reductio_median=require("./median.js");var reductio_min=require("./min.js");var reductio_max=require("./max.js");var reductio_value_count=require("./value-count.js");var reductio_value_list=require("./value-list.js");var reductio_exception_count=require("./exception-count.js");var reductio_exception_sum=require("./exception-sum.js");var reductio_histogram=require("./histogram.js");var reductio_sum_of_sq=require("./sum-of-squares.js");var reductio_std=require("./std.js");var reductio_nest=require("./nest.js");var reductio_alias=require("./alias.js");var reductio_alias_prop=require("./aliasProp.js");var reductio_data_list=require("./data-list.js");var reductio_custom=require("./custom.js");function build_function(p,f,path){if(!path)path=function(d){return d};var origF={reduceAdd:f.reduceAdd,reduceRemove:f.reduceRemove,reduceInitial:f.reduceInitial};if(p.count||p.std){f.reduceAdd=reductio_count.add(f.reduceAdd,path,p.count);f.reduceRemove=reductio_count.remove(f.reduceRemove,path,p.count);f.reduceInitial=reductio_count.initial(f.reduceInitial,path,p.count)}if(p.sum){f.reduceAdd=reductio_sum.add(p.sum,f.reduceAdd,path);f.reduceRemove=reductio_sum.remove(p.sum,f.reduceRemove,path);f.reduceInitial=reductio_sum.initial(f.reduceInitial,path)}if(p.avg){if(!p.count||!p.sum){console.error("You must set .count(true) and define a .sum(accessor) to use .avg(true).")}else{f.reduceAdd=reductio_avg.add(p.sum,f.reduceAdd,path);f.reduceRemove=reductio_avg.remove(p.sum,f.reduceRemove,path);f.reduceInitial=reductio_avg.initial(f.reduceInitial,path)}}if(p.exceptionCount){if(!p.exceptionAccessor){console.error("You must define an .exception(accessor) to use .exceptionCount(true).")}else{f.reduceAdd=reductio_exception_count.add(p.exceptionAccessor,f.reduceAdd,path);f.reduceRemove=reductio_exception_count.remove(p.exceptionAccessor,f.reduceRemove,path);f.reduceInitial=reductio_exception_count.initial(f.reduceInitial,path)}}if(p.exceptionSum){if(!p.exceptionAccessor){console.error("You must define an .exception(accessor) to use .exceptionSum(accessor).")}else{f.reduceAdd=reductio_exception_sum.add(p.exceptionAccessor,p.exceptionSum,f.reduceAdd,path);f.reduceRemove=reductio_exception_sum.remove(p.exceptionAccessor,p.exceptionSum,f.reduceRemove,path);f.reduceInitial=reductio_exception_sum.initial(f.reduceInitial,path)}}if(p.valueList||p.median||p.min||p.max){f.reduceAdd=reductio_value_list.add(p.valueList,f.reduceAdd,path);f.reduceRemove=reductio_value_list.remove(p.valueList,f.reduceRemove,path);f.reduceInitial=reductio_value_list.initial(f.reduceInitial,path)}if(p.dataList){f.reduceAdd=reductio_data_list.add(p.dataList,f.reduceAdd,path);f.reduceRemove=reductio_data_list.remove(p.dataList,f.reduceRemove,path);f.reduceInitial=reductio_data_list.initial(f.reduceInitial,path)}if(p.median){f.reduceAdd=reductio_median.add(f.reduceAdd,path);f.reduceRemove=reductio_median.remove(f.reduceRemove,path);f.reduceInitial=reductio_median.initial(f.reduceInitial,path)}if(p.min){f.reduceAdd=reductio_min.add(f.reduceAdd,path);f.reduceRemove=reductio_min.remove(f.reduceRemove,path);f.reduceInitial=reductio_min.initial(f.reduceInitial,path)}if(p.max){f.reduceAdd=reductio_max.add(f.reduceAdd,path);f.reduceRemove=reductio_max.remove(f.reduceRemove,path);f.reduceInitial=reductio_max.initial(f.reduceInitial,path)}if(p.exceptionAccessor){f.reduceAdd=reductio_value_count.add(p.exceptionAccessor,f.reduceAdd,path);f.reduceRemove=reductio_value_count.remove(p.exceptionAccessor,f.reduceRemove,path);f.reduceInitial=reductio_value_count.initial(f.reduceInitial,path)}if(p.histogramValue&&p.histogramThresholds){f.reduceAdd=reductio_histogram.add(p.histogramValue,f.reduceAdd,path);f.reduceRemove=reductio_histogram.remove(p.histogramValue,f.reduceRemove,path);f.reduceInitial=reductio_histogram.initial(p.histogramThresholds,f.reduceInitial,path)}if(p.sumOfSquares){f.reduceAdd=reductio_sum_of_sq.add(p.sumOfSquares,f.reduceAdd,path);f.reduceRemove=reductio_sum_of_sq.remove(p.sumOfSquares,f.reduceRemove,path);f.reduceInitial=reductio_sum_of_sq.initial(f.reduceInitial,path)}if(p.std){if(!p.sumOfSquares||!p.sum){console.error("You must set .sumOfSq(accessor) and define a .sum(accessor) to use .std(true). Or use .std(accessor).")}else{f.reduceAdd=reductio_std.add(f.reduceAdd,path);f.reduceRemove=reductio_std.remove(f.reduceRemove,path);f.reduceInitial=reductio_std.initial(f.reduceInitial,path)}}if(p.custom){f.reduceAdd=reductio_custom.add(f.reduceAdd,path,p.custom.add);f.reduceRemove=reductio_custom.remove(f.reduceRemove,path,p.custom.remove);f.reduceInitial=reductio_custom.initial(f.reduceInitial,path,p.custom.initial)}if(p.nestKeys){f.reduceAdd=reductio_nest.add(p.nestKeys,f.reduceAdd,path);f.reduceRemove=reductio_nest.remove(p.nestKeys,f.reduceRemove,path);f.reduceInitial=reductio_nest.initial(f.reduceInitial,path)}if(p.aliasKeys){f.reduceInitial=reductio_alias.initial(f.reduceInitial,path,p.aliasKeys)}if(p.aliasPropKeys){f.reduceAdd=reductio_alias_prop.add(p.aliasPropKeys,f.reduceAdd,path);f.reduceRemove=reductio_alias_prop.add(p.aliasPropKeys,f.reduceRemove,path)}if(p.filter){f.reduceAdd=reductio_filter.add(p.filter,f.reduceAdd,origF.reduceAdd,path);f.reduceRemove=reductio_filter.remove(p.filter,f.reduceRemove,origF.reduceRemove,path)}if(p.values){Object.getOwnPropertyNames(p.values).forEach(function(n){var setupPath=function(prior){return function(p){p=prior(p);path(p)[n]={};return p}};f.reduceInitial=setupPath(f.reduceInitial);build_function(p.values[n].parameters,f,function(p){return p[n]})})}}var reductio_build={build:build_function};module.exports=reductio_build},{"./alias.js":20,"./aliasProp.js":21,"./avg.js":22,"./count.js":25,"./custom.js":26,"./data-list.js":27,"./exception-count.js":28,"./exception-sum.js":29,"./filter.js":30,"./histogram.js":31,"./max.js":32,"./median.js":33,"./min.js":34,"./nest.js":35,"./std.js":41,"./sum-of-squares.js":42,"./sum.js":43,"./value-count.js":44,"./value-list.js":45}],24:[function(require,module,exports){var pluck=function(n){return function(d){return d[n]}};_grouper=function(path,prior){if(!path)path=function(d){return d};return function(p,v){if(prior)prior(p,v);var x=path(p),y=path(v);if(typeof y.count!=="undefined")x.count+=y.count;if(typeof y.sum!=="undefined")x.sum+=y.sum;if(typeof y.avg!=="undefined")x.avg=x.sum/x.count;return p}};reductio_cap=function(prior,f,p){var obj=f.reduceInitial();var values=p.values?Object.keys(p.values):[];var _othersGrouper=_grouper();if(values.length){for(var i=0;i<values.length;++i){_othersGrouper=_grouper(pluck(values[i]),_othersGrouper)}}return function(cap,othersName){if(!arguments.length)return prior();if(cap===Infinity||!cap)return prior();var all=prior();var slice_idx=cap-1;if(all.length<=cap)return all;var data=all.slice(0,slice_idx);var others={key:othersName||"Others"};others.value=f.reduceInitial();for(var i=slice_idx;i<all.length;++i){_othersGrouper(others.value,all[i].value)}data.push(others);return data}};module.exports=reductio_cap},{}],25:[function(require,module,exports){var reductio_count={add:function(prior,path,propName){return function(p,v,nf){if(prior)prior(p,v,nf);path(p)[propName]++;return p}},remove:function(prior,path,propName){return function(p,v,nf){if(prior)prior(p,v,nf);path(p)[propName]--;return p}},initial:function(prior,path,propName){return function(p){if(prior)p=prior(p);path(p)[propName]=0;return p}}};module.exports=reductio_count},{}],26:[function(require,module,exports){var reductio_custom={add:function(prior,path,addFn){return function(p,v,nf){if(prior)prior(p,v,nf);return addFn(p,v)}},remove:function(prior,path,removeFn){return function(p,v,nf){if(prior)prior(p,v,nf);return removeFn(p,v)}},initial:function(prior,path,initialFn){return function(p){if(prior)p=prior(p);return initialFn(p)}}};module.exports=reductio_custom},{}],27:[function(require,module,exports){var reductio_data_list={add:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).dataList.push(v);return p}},remove:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).dataList.splice(path(p).dataList.indexOf(v),1);return p}},initial:function(prior,path){return function(p){if(prior)p=prior(p);path(p).dataList=[];return p}}};module.exports=reductio_data_list},{}],28:[function(require,module,exports){var reductio_exception_count={add:function(a,prior,path){var i,curr;return function(p,v,nf){if(prior)prior(p,v,nf);i=path(p).bisect(path(p).values,a(v),0,path(p).values.length);curr=path(p).values[i];if(!curr||curr[0]!==a(v)||curr[1]===0){path(p).exceptionCount++}return p}},remove:function(a,prior,path){var i,curr;return function(p,v,nf){if(prior)prior(p,v,nf);i=path(p).bisect(path(p).values,a(v),0,path(p).values.length);curr=path(p).values[i];if(curr&&curr[0]===a(v)&&curr[1]===1){path(p).exceptionCount--}return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).exceptionCount=0;return p}}};module.exports=reductio_exception_count},{}],29:[function(require,module,exports){var reductio_exception_sum={add:function(a,sum,prior,path){var i,curr;return function(p,v,nf){if(prior)prior(p,v,nf);i=path(p).bisect(path(p).values,a(v),0,path(p).values.length);curr=path(p).values[i];if(!curr||curr[0]!==a(v)||curr[1]===0){path(p).exceptionSum=path(p).exceptionSum+sum(v)}return p}},remove:function(a,sum,prior,path){var i,curr;return function(p,v,nf){if(prior)prior(p,v,nf);i=path(p).bisect(path(p).values,a(v),0,path(p).values.length);curr=path(p).values[i];if(curr&&curr[0]===a(v)&&curr[1]===1){path(p).exceptionSum=path(p).exceptionSum-sum(v)}return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).exceptionSum=0;return p}}};module.exports=reductio_exception_sum},{}],30:[function(require,module,exports){var reductio_filter={add:function(filter,prior,skip){return function(p,v,nf){if(filter(v,nf)){if(prior)prior(p,v,nf)}else{if(skip)skip(p,v,nf)}return p}},remove:function(filter,prior,skip){return function(p,v,nf){if(filter(v,nf)){if(prior)prior(p,v,nf)}else{if(skip)skip(p,v,nf)}return p}}};module.exports=reductio_filter},{}],31:[function(require,module,exports){var crossfilter=require("crossfilter2");var reductio_histogram={add:function(a,prior,path){var bisect=crossfilter.bisect.by(function(d){return d}).left;var bisectHisto=crossfilter.bisect.by(function(d){return d.x}).right;var curr;return function(p,v,nf){if(prior)prior(p,v,nf);curr=path(p).histogram[bisectHisto(path(p).histogram,a(v),0,path(p).histogram.length)-1];curr.y++;curr.splice(bisect(curr,a(v),0,curr.length),0,a(v));return p}},remove:function(a,prior,path){var bisect=crossfilter.bisect.by(function(d){return d}).left;var bisectHisto=crossfilter.bisect.by(function(d){return d.x}).right;var curr;return function(p,v,nf){if(prior)prior(p,v,nf);curr=path(p).histogram[bisectHisto(path(p).histogram,a(v),0,path(p).histogram.length)-1];curr.y--;curr.splice(bisect(curr,a(v),0,curr.length),1);return p}},initial:function(thresholds,prior,path){return function(p){p=prior(p);path(p).histogram=[];var arr=[];for(var i=1;i<thresholds.length;i++){arr=[];arr.x=thresholds[i-1];arr.dx=thresholds[i]-thresholds[i-1];arr.y=0;path(p).histogram.push(arr)}return p}}};module.exports=reductio_histogram},{crossfilter2:1}],32:[function(require,module,exports){var reductio_max={add:function(prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).max=path(p).valueList[path(p).valueList.length-1];return p}},remove:function(prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);if(path(p).valueList.length===0){path(p).max=undefined;return p}path(p).max=path(p).valueList[path(p).valueList.length-1];return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).max=undefined;return p}}};module.exports=reductio_max},{}],33:[function(require,module,exports){var reductio_median={add:function(prior,path){var half;return function(p,v,nf){if(prior)prior(p,v,nf);half=Math.floor(path(p).valueList.length/2);if(path(p).valueList.length%2){path(p).median=path(p).valueList[half]}else{path(p).median=(path(p).valueList[half-1]+path(p).valueList[half])/2}return p}},remove:function(prior,path){var half;return function(p,v,nf){if(prior)prior(p,v,nf);half=Math.floor(path(p).valueList.length/2);if(path(p).valueList.length===0){path(p).median=undefined;return p}if(path(p).valueList.length===1||path(p).valueList.length%2){path(p).median=path(p).valueList[half]}else{path(p).median=(path(p).valueList[half-1]+path(p).valueList[half])/2}return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).median=undefined;return p}}};module.exports=reductio_median},{}],34:[function(require,module,exports){var reductio_min={add:function(prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).min=path(p).valueList[0];return p}},remove:function(prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);if(path(p).valueList.length===0){path(p).min=undefined;return p}path(p).min=path(p).valueList[0];return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).min=undefined;return p}}};module.exports=reductio_min},{}],35:[function(require,module,exports){var crossfilter=require("crossfilter2");var reductio_nest={add:function(keyAccessors,prior,path){var i;var arrRef;var newRef;return function(p,v,nf){if(prior)prior(p,v,nf);arrRef=path(p).nest;keyAccessors.forEach(function(a){newRef=arrRef.filter(function(d){return d.key===a(v)})[0];if(newRef){arrRef=newRef.values}else{newRef=[];arrRef.push({key:a(v),values:newRef});arrRef=newRef}});arrRef.push(v);return p}},remove:function(keyAccessors,prior,path){var arrRef;var nextRef;return function(p,v,nf){if(prior)prior(p,v,nf);arrRef=path(p).nest;keyAccessors.forEach(function(a){arrRef=arrRef.filter(function(d){return d.key===a(v)})[0].values});arrRef.splice(arrRef.indexOf(v),1);return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).nest=[];return p}}};module.exports=reductio_nest},{crossfilter2:1}],36:[function(require,module,exports){var reductio_parameters=function(){return{order:false,avg:false,count:false,sum:false,exceptionAccessor:false,exceptionCount:false,exceptionSum:false,filter:false,valueList:false,median:false,histogramValue:false,min:false,max:false,histogramThresholds:false,std:false,sumOfSquares:false,values:false,nestKeys:false,aliasKeys:false,aliasPropKeys:false,groupAll:false,dataList:false,custom:false}};module.exports=reductio_parameters},{}],37:[function(require,module,exports){function postProcess(reductio){return function(group,p,f){group.post=function(){var postprocess=function(){return postprocess.all()};postprocess.all=function(){return group.all()};var postprocessors=reductio.postprocessors;Object.keys(postprocessors).forEach(function(name){postprocess[name]=function(){var _all=postprocess.all;var args=[].slice.call(arguments);postprocess.all=function(){return postprocessors[name](_all,f,p).apply(null,args)};return postprocess}});return postprocess}}}module.exports=postProcess},{}],38:[function(require,module,exports){module.exports=function(reductio){reductio.postprocessors={};reductio.registerPostProcessor=function(name,func){reductio.postprocessors[name]=func};reductio.registerPostProcessor("cap",require("./cap"));reductio.registerPostProcessor("sortBy",require("./sortBy"))}},{"./cap":24,"./sortBy":40}],39:[function(require,module,exports){var reductio_build=require("./build.js");var reductio_accessors=require("./accessors.js");var reductio_parameters=require("./parameters.js");var reductio_postprocess=require("./postprocess");var crossfilter=require("crossfilter2");function reductio(){var parameters=reductio_parameters();var funcs={};function my(group){funcs={reduceAdd:function(p){return p},reduceRemove:function(p){return p},reduceInitial:function(){return{}}};reductio_build.build(parameters,funcs);if(parameters.groupAll){if(group.top){console.warn("'groupAll' is defined but attempting to run on a standard dimension.group(). Must run on dimension.groupAll().")}else{var bisect=crossfilter.bisect.by(function(d){return d.key}).left;var i,j;var keys;var keysLength;var k;group.reduce(function(p,v,nf){keys=parameters.groupAll(v);keysLength=keys.length;for(j=0;j<keysLength;j++){k=keys[j];i=bisect(p,k,0,p.length);if(!p[i]||p[i].key!==k){p.splice(i,0,{key:k,value:funcs.reduceInitial()})}funcs.reduceAdd(p[i].value,v,nf)}return p},function(p,v,nf){keys=parameters.groupAll(v);keysLength=keys.length;for(j=0;j<keysLength;j++){i=bisect(p,keys[j],0,p.length);funcs.reduceRemove(p[i].value,v,nf)}return p},function(){return[]});if(!group.all){group.all=function(){return this.value()}}}}else{group.reduce(funcs.reduceAdd,funcs.reduceRemove,funcs.reduceInitial)}reductio_postprocess(group,parameters,funcs);return group}reductio_accessors.build(my,parameters);return my}require("./postprocessors")(reductio);reductio_postprocess=reductio_postprocess(reductio);module.exports=reductio},{"./accessors.js":19,"./build.js":23,"./parameters.js":36,"./postprocess":37,"./postprocessors":38,crossfilter2:1}],40:[function(require,module,exports){var pluck_n=function(n){if(typeof n==="function"){return n}if(~n.indexOf(".")){var split=n.split(".");return function(d){return split.reduce(function(p,v){return p[v]},d)}}return function(d){return d[n]}};function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}var comparer=function(accessor,ordering){return function(a,b){return ordering(accessor(a),accessor(b))}};var type={}.toString;module.exports=function(prior){return function(value,order){if(arguments.length===1){order=ascending}return prior().sort(comparer(pluck_n(value),order))}}},{}],41:[function(require,module,exports){var reductio_std={add:function(prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);if(path(p).count>0){path(p).std=0;var n=path(p).sumOfSq-path(p).sum*path(p).sum/path(p).count;if(n>0)path(p).std=Math.sqrt(n/(path(p).count-1))}else{path(p).std=0}return p}},remove:function(prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);if(path(p).count>0){path(p).std=0;var n=path(p).sumOfSq-path(p).sum*path(p).sum/path(p).count;if(n>0)path(p).std=Math.sqrt(n/(path(p).count-1))}else{path(p).std=0}return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).std=0;return p}}};module.exports=reductio_std},{}],42:[function(require,module,exports){var reductio_sum_of_sq={add:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).sumOfSq=path(p).sumOfSq+a(v)*a(v);return p}},remove:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).sumOfSq=path(p).sumOfSq-a(v)*a(v);return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).sumOfSq=0;return p}}};module.exports=reductio_sum_of_sq},{}],43:[function(require,module,exports){var reductio_sum={add:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).sum=path(p).sum+a(v);return p}},remove:function(a,prior,path){return function(p,v,nf){if(prior)prior(p,v,nf);path(p).sum=path(p).sum-a(v);return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).sum=0;return p}}};module.exports=reductio_sum},{}],44:[function(require,module,exports){var crossfilter=require("crossfilter2");var reductio_value_count={add:function(a,prior,path){var i,curr;return function(p,v,nf){if(prior)prior(p,v,nf);i=path(p).bisect(path(p).values,a(v),0,path(p).values.length);curr=path(p).values[i];if(curr&&curr[0]===a(v)){curr[1]++}else{path(p).values.splice(i,0,[a(v),1])}return p}},remove:function(a,prior,path){var i;return function(p,v,nf){if(prior)prior(p,v,nf);i=path(p).bisect(path(p).values,a(v),0,path(p).values.length);path(p).values[i][1]--;return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).values=[];path(p).bisect=crossfilter.bisect.by(function(d){return d[0]}).left
;return p}}};module.exports=reductio_value_count},{crossfilter2:1}],45:[function(require,module,exports){var crossfilter=require("crossfilter2");var reductio_value_list={add:function(a,prior,path){var i;var bisect=crossfilter.bisect.by(function(d){return d}).left;return function(p,v,nf){if(prior)prior(p,v,nf);i=bisect(path(p).valueList,a(v),0,path(p).valueList.length);path(p).valueList.splice(i,0,a(v));return p}},remove:function(a,prior,path){var i;var bisect=crossfilter.bisect.by(function(d){return d}).left;return function(p,v,nf){if(prior)prior(p,v,nf);i=bisect(path(p).valueList,a(v),0,path(p).valueList.length);path(p).valueList.splice(i,1);return p}},initial:function(prior,path){return function(p){p=prior(p);path(p).valueList=[];return p}}};module.exports=reductio_value_list},{crossfilter2:1}],46:[function(require,module,exports){"use strict";var _=require("./lodash");var aggregators={$sum:$sum,$avg:$avg,$max:$max,$min:$min,$count:$count,$first:$first,$last:$last,$get:$get,$nth:$get,$nthLast:$nthLast,$nthPct:$nthPct,$map:$map};module.exports={makeValueAccessor:makeValueAccessor,aggregators:aggregators,extractKeyValOrArray:extractKeyValOrArray,parseAggregatorParams:parseAggregatorParams};function makeValueAccessor(obj){if(typeof obj==="string"){if(isStringSyntax(obj)){obj=convertAggregatorString(obj)}else{return obj}}if(typeof obj==="number"){return obj}if(_.isObject(obj)){return make()}function make(){var stack=makeSubAggregationFunction(obj);return function topStack(d){return stack(d)}}}function makeSubAggregationFunction(obj){obj=_.isObject(obj)?extractKeyValOrArray(obj):obj;if(_.isString(obj)){if(isStringSyntax(obj)){return makeSubAggregationFunction(convertAggregatorString(obj))}return function identity(d){return d[obj]}}if(_.isArray(obj)){var subStack=_.map(obj,makeSubAggregationFunction);return function getSubStack(d){return subStack.map(function(s){return s(d)})}}if(obj.key){if(aggregators[obj.key]){var subAggregationFunction=makeSubAggregationFunction(obj.value);return function getAggregation(d){return aggregators[obj.key](subAggregationFunction(d))}}console.error("Could not find aggregration method",obj)}return[]}function extractKeyValOrArray(obj){var keyVal;var values=[];for(var key in obj){if({}.hasOwnProperty.call(obj,key)){keyVal={key:key,value:obj[key]};var subObj={};subObj[key]=obj[key];values.push(subObj)}}return values.length>1?values:keyVal}function isStringSyntax(str){return["$","("].indexOf(str.charAt(0))>-1}function parseAggregatorParams(keyString){var params=[];var p1=keyString.indexOf("(");var p2=keyString.indexOf(")");var key=p1>-1?keyString.substring(0,p1):keyString;if(!aggregators[key]){return false}if(p1>-1&&p2>-1&&p2>p1){params=keyString.substring(p1+1,p2).split(",")}return{aggregator:aggregators[key],params:params}}function convertAggregatorString(keyString){var outerParens=/\((.+)\)/g;var hasComma=/(?:\([^\(\)]*\))|(,)/g;return JSON.parse("{"+unwrapParensAndCommas(keyString)+"}");function unwrapParensAndCommas(str){str=str.replace(" ","");return'"'+str.replace(outerParens,function(p,pr){if(hasComma.test(pr)){if(pr.charAt(0)==="$"){return'":{"'+pr.replace(hasComma,function(p2){if(p2===","){return',"'}return unwrapParensAndCommas(p2).trim()})+"}"}return':["'+pr.replace(hasComma,function(){return'","'})+'"]'}})}}function $sum(children){return children.reduce(function(a,b){return a+b},0)}function $avg(children){return children.reduce(function(a,b){return a+b},0)/children.length}function $max(children){return Math.max.apply(null,children)}function $min(children){return Math.min.apply(null,children)}function $count(children){return children.length}function $first(children){return children[0]}function $last(children){return children[children.length-1]}function $get(children,n){return children[n]}function $nthLast(children,n){return children[children.length-n]}function $nthPct(children,n){return children[Math.round(children.length*(n/100))]}function $map(children,n){return children.map(function(d){return d[n]})}},{"./lodash":54}],47:[function(require,module,exports){"use strict";var Promise=require("q");var _=require("./lodash");module.exports=function(service){return function clear(def){if(def){def=_.isArray(def)?def:[def]}if(!def){return Promise.all(_.map(service.columns,disposeColumn)).then(function(){service.columns=[];return service})}return Promise.all(_.map(def,function(d){if(_.isObject(d)){d=d.key}var column=_.remove(service.columns,function(c){if(_.isArray(d)){return!_.xor(c.key,d).length}if(c.key===d){if(c.dynamicReference){return false}return true}})[0];if(!column){return}disposeColumn(column)})).then(function(){return service});function disposeColumn(column){var disposalActions=[];if(column.removeListeners){disposalActions=_.map(column.removeListeners,function(listener){return Promise.resolve(listener())})}var filterKey=column.key;if(column.complex==="array"){filterKey=JSON.stringify(column.key)}if(column.complex==="function"){filterKey=column.key.toString()}delete service.filters[filterKey];if(column.dimension){disposalActions.push(Promise.resolve(column.dimension.dispose()))}return Promise.all(disposalActions)}}}},{"./lodash":54,q:18}],48:[function(require,module,exports){"use strict";var Promise=require("q");var _=require("./lodash");module.exports=function(service){var dimension=require("./dimension")(service);var columnFunc=column;columnFunc.find=findColumn;return columnFunc;function column(def){if(_.isUndefined(def)){def=true}if(!_.isArray(def)){def=[def]}return Promise.all(_.map(def,makeColumn)).then(function(){return service})}function findColumn(d){return _.find(service.columns,function(c){if(_.isArray(d)){return!_.xor(c.key,d).length}return c.key===d})}function getType(d){if(_.isNumber(d)){return"number"}if(_.isBoolean(d)){return"bool"}if(_.isArray(d)){return"array"}if(_.isObject(d)){return"object"}return"string"}function makeColumn(d){var column=_.isObject(d)?d:{key:d};var existing=findColumn(column.key);if(existing){existing.temporary=false;if(existing.dynamicReference){existing.dynamicReference=false}return existing.promise.then(function(){return service})}column.queries=[];service.columns.push(column);column.promise=Promise.try(function(){return Promise.resolve(service.cf.all())}).then(function(all){var sample;if(_.isFunction(column.key)){column.complex="function";sample=column.key(all[0])}else if(_.isString(column.key)&&(column.key.indexOf(".")>-1||column.key.indexOf("[")>-1)){column.complex="string";sample=_.get(all[0],column.key)}else if(_.isArray(column.key)){column.complex="array";sample=_.values(_.pick(all[0],column.key));if(sample.length!==column.key.length){throw new Error("Column key does not exist in data!",column.key)}}else{sample=all[0][column.key]}if(!column.complex&&column.key!==true&&typeof sample==="undefined"){throw new Error("Column key does not exist in data!",column.key)}if(column.key===true){column.type="all"}else if(column.complex){column.type="complex"}else if(column.array){column.type="array"}else{column.type=getType(sample)}return dimension.make(column.key,column.type,column.complex)}).then(function(dim){column.dimension=dim;column.filterCount=0;var stopListeningForData=service.onDataChange(buildColumnKeys);column.removeListeners=[stopListeningForData];return buildColumnKeys();function buildColumnKeys(changes){if(column.key===true){return Promise.resolve()}var accessor=dimension.makeAccessor(column.key,column.complex);column.values=column.values||[];return Promise.try(function(){if(changes&&changes.added){return Promise.resolve(changes.added)}return Promise.resolve(column.dimension.bottom(Infinity))}).then(function(rows){var newValues;if(column.complex==="string"||column.complex==="function"){newValues=_.map(rows,accessor)}else if(column.type==="array"){newValues=_.flatten(_.map(rows,accessor))}else{newValues=_.map(rows,accessor)}column.values=_.uniq(column.values.concat(newValues))})}});return column.promise.then(function(){return service})}}},{"./dimension":51,"./lodash":54,q:18}],49:[function(require,module,exports){"use strict";var Promise=require("q");var crossfilter=require("crossfilter2");var _=require("./lodash");module.exports=function(service){return{build:build,generateColumns:generateColumns,add:add,remove:remove};function build(c){if(_.isArray(c)){return Promise.resolve(crossfilter(c))}if(!c||typeof c.dimension!=="function"){return Promise.reject(new Error("No Crossfilter data or instance found!"))}return Promise.resolve(c)}function generateColumns(data){if(!service.options.generatedColumns){return data}return _.map(data,function(d){_.forEach(service.options.generatedColumns,function(val,key){d[key]=val(d)});return d})}function add(data){data=generateColumns(data);return Promise.try(function(){return Promise.resolve(service.cf.add(data))}).then(function(){return Promise.serial(_.map(service.dataListeners,function(listener){return function(){return listener({added:data})}}))}).then(function(){return service})}function remove(){return Promise.try(function(){return Promise.resolve(service.cf.remove())}).then(function(){return service})}}},{"./lodash":54,crossfilter2:1,q:18}],50:[function(require,module,exports){"use strict";var Promise=require("q");module.exports=function(service){return function destroy(){return service.clear().then(function(){service.cf.dataListeners=[];service.cf.filterListeners=[];return Promise.resolve(service.cf.remove())}).then(function(){return service})}}},{q:18}],51:[function(require,module,exports){"use strict";var Promise=require("q");var _=require("./lodash");module.exports=function(service){return{make:make,makeAccessor:makeAccessor};function make(key,type,complex){var accessor=makeAccessor(key,complex);return Promise.resolve(service.cf.dimension(accessor,type==="array"))}function makeAccessor(key,complex){var accessorFunction;if(complex==="string"){accessorFunction=function(d){return _.get(d,key)}}else if(complex==="function"){accessorFunction=key}else if(complex==="array"){var arrayString=_.map(key,function(k){return"d['"+k+"']"});accessorFunction=new Function("d",String("return "+JSON.stringify(arrayString).replace(/"/g,"")))}else{accessorFunction=key===true?function accessor(d,i){return i}:function(d){return d[key]}}return accessorFunction}}},{"./lodash":54,q:18}],52:[function(require,module,exports){"use strict";module.exports={$field:$field,$and:$and,$or:$or,$not:$not,$eq:$eq,$gt:$gt,$gte:$gte,$lt:$lt,$lte:$lte,$ne:$ne,$type:$type,$in:$in,$nin:$nin,$contains:$contains,$excludes:$excludes,$size:$size};function $field(d,child){return d[child]}function $and(d,child){child=child(d);for(var i=0;i<child.length;i++){if(!child[i]){return false}}return true}function $or(d,child){child=child(d);for(var i=0;i<child.length;i++){if(child[i]){return true}}return false}function $not(d,child){child=child(d);for(var i=0;i<child.length;i++){if(child[i]){return false}}return true}function $eq(d,child){return d===child()}function $gt(d,child){return d>child()}function $gte(d,child){return d>=child()}function $lt(d,child){return d<child()}function $lte(d,child){return d<=child()}function $ne(d,child){return d!==child()}function $type(d,child){return typeof d===child()}function $in(d,child){return d.indexOf(child())>-1}function $nin(d,child){return d.indexOf(child())===-1}function $contains(d,child){return child().indexOf(d)>-1}function $excludes(d,child){return child().indexOf(d)===-1}function $size(d,child){return d.length===child()}},{}],53:[function(require,module,exports){"use strict";var Promise=require("q");var _=require("./lodash");var expressions=require("./expressions");var aggregation=require("./aggregation");module.exports=function(service){return{filter:filter,filterAll:filterAll,applyFilters:applyFilters,makeFunction:makeFunction,scanForDynamicFilters:scanForDynamicFilters};function filter(column,fil,isRange,replace){return getColumn(column).then(function(column){var newFilters=_.assign({},service.filters);var filterKey=column.key;if(column.complex==="array"){filterKey=JSON.stringify(column.key)}if(column.complex==="function"){filterKey=column.key.toString()}newFilters[filterKey]=buildFilterObject(fil,isRange,replace);return applyFilters(newFilters)})}function getColumn(column){var exists=service.column.find(column);return Promise.try(function(){if(!exists){return service.column({key:column,temporary:true}).then(function(){return service.column.find(column)})}return exists})}function filterAll(fils){if(!fils){service.columns.forEach(function(col){col.dimension.filterAll()});return applyFilters({})}var newFilters=_.assign({},service.filters);var ds=_.map(fils,function(fil){return getColumn(fil.column).then(function(column){var filterKey=column.complex?JSON.stringify(column.key):column.key;newFilters[filterKey]=buildFilterObject(fil.value,fil.isRange,fil.replace)})});return Promise.all(ds).then(function(){return applyFilters(newFilters)})}function buildFilterObject(fil,isRange,replace){if(_.isUndefined(fil)){return false}if(_.isFunction(fil)){return{value:fil,function:fil,replace:true,type:"function"}}if(_.isObject(fil)){return{value:fil,function:makeFunction(fil),replace:true,type:"function"}}if(_.isArray(fil)){return{value:fil,replace:isRange||replace,type:isRange?"range":"inclusive"}}return{value:fil,replace:replace,type:"exact"}}function applyFilters(newFilters){var ds=_.map(newFilters,function(fil,i){var existing=service.filters[i];if(fil===existing){return Promise.resolve()}var column;if(i.charAt(0)==="["){column=service.column.find(JSON.parse(i))}else{column=service.column.find(i)}if(fil&&existing&&!fil.replace){newFilters[i]=fil=toggleFilters(fil,existing)}if(!fil){return Promise.resolve(column.dimension.filterAll())}if(fil.type==="exact"){return Promise.resolve(column.dimension.filterExact(fil.value))}if(fil.type==="range"){return Promise.resolve(column.dimension.filterRange(fil.value))}if(fil.type==="inclusive"){return Promise.resolve(column.dimension.filterFunction(function(d){return fil.value.indexOf(d)>-1}))}if(fil.type==="function"){return Promise.resolve(column.dimension.filterFunction(fil.function))}return Promise.resolve(column.dimension.filterAll())});return Promise.all(ds).then(function(){service.filters=newFilters;var tryRemoval=[];_.forEach(service.filters,function(val,key){if(!val){tryRemoval.push({key:key,val:val});delete service.filters[key]}});return Promise.all(_.map(tryRemoval,function(v){var column=service.column.find(v.key.charAt(0)==="["?JSON.parse(v.key):v.key);if(column.temporary&&!column.dynamicReference){return service.clear(column.key)}}))}).then(function(){return Promise.all(_.map(service.filterListeners,function(listener){return listener()}))}).then(function(){return service})}function toggleFilters(fil,existing){if(fil.type==="exact"&&existing.type==="inclusive"){fil.value=_.xor([fil.value],existing.value)}else if(fil.type==="inclusive"&&existing.type==="exact"){fil.value=_.xor(fil.value,[existing.value])}else if(fil.type==="inclusive"&&existing.type==="inclusive"){fil.value=_.xor(fil.value,existing.value)}else if(fil.type==="exact"&&existing.type==="exact"){if(fil.value===existing.value){return false}fil.value=[fil.value,existing.value]}if(!fil.value.length){fil=false}else if(fil.value.length===1){fil.type="exact";fil.value=fil.value[0]}else{fil.type="inclusive"}return fil}function scanForDynamicFilters(query){var columns=[];walk(query.filter);return columns;function walk(obj){_.forEach(obj,function(val,key){var ref=findDataReferences(val,key);if(ref){columns.push(ref)}if(_.isString(val)){ref=findDataReferences(null,val);if(ref){columns.push(ref)}}if(_.isObject(val)){walk(val)}})}}function findDataReferences(val,key){if(key==="$data"){return true}if(key&&key==="$column"){if(_.isString(val)){return val}console.warn('The value for filter "$column" must be a valid column key',val);return false}}function makeFunction(obj,isAggregation){var subGetters;if(_.isString(obj)){var dataRef=findDataReferences(null,obj);if(dataRef){var data=service.cf.all();return function(){return data}}}if(_.isString(obj)||_.isNumber(obj)||_.isBoolean(obj)){return function(d){if(typeof d==="undefined"){return obj}return expressions.$eq(d,function(){return obj})}}if(_.isArray(obj)){subGetters=_.map(obj,function(o){return makeFunction(o,isAggregation)});return function(d){return subGetters.map(function(s){return s(d)})}}if(_.isObject(obj)){subGetters=_.map(obj,function(val,key){var getSub=makeFunction(val,isAggregation);var dataRef=findDataReferences(val,key);if(dataRef){var column=service.column.find(dataRef);var data=column.values;return function(){return data}}if(expressions[key]){return function(d){return expressions[key](d,getSub)}}var aggregatorObj=aggregation.parseAggregatorParams(key);if(aggregatorObj){isAggregation=true;getSub=makeFunction(val,isAggregation);return function(){return aggregatorObj.aggregator.apply(null,[getSub()].concat(aggregatorObj.params))}}return function(d){d=d[key];return getSub(d,getSub)}});if(isAggregation){if(subGetters.length===1){return function(d){return subGetters[0](d)}}return function(d){return _.map(subGetters,function(getSub){return getSub(d)})}}return function(d){return expressions.$and(d,function(d){return _.map(subGetters,function(getSub){return getSub(d)})})}}console.log("no expression found for ",obj);return false}}},{"./aggregation":46,"./expressions":52,"./lodash":54,q:18}],54:[function(require,module,exports){"use strict";module.exports={assign:assign,find:find,remove:remove,isArray:isArray,isObject:isObject,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isFunction:isFunction,get:get,set:set,map:map,keys:keys,sortBy:sortBy,forEach:forEach,isUndefined:isUndefined,pick:pick,xor:xor,clone:clone,isEqual:isEqual,replaceArray:replaceArray,uniq:uniq,flatten:flatten,sort:sort,values:values,recurseObject:recurseObject};function assign(out){out=out||{};for(var i=1;i<arguments.length;i++){if(!arguments[i]){continue}for(var key in arguments[i]){if(arguments[i].hasOwnProperty(key)){out[key]=arguments[i][key]}}}return out}function find(a,b){return a.find(b)}function remove(a,b){return a.filter(function(o,i){var r=b(o);if(r){a.splice(i,1);return true}return false})}function isArray(a){return Array.isArray(a)}function isObject(d){return typeof d==="object"&&!isArray(d)}function isBoolean(d){return typeof d==="boolean"}function isString(d){return typeof d==="string"}function isNumber(d){return typeof d==="number"}function isFunction(a){return typeof a==="function"}function get(a,b){if(isArray(b)){b=b.join(".")}return b.replace("[",".").replace("]","").split(".").reduce(function(obj,property){return obj[property]},a)}function set(obj,prop,value){if(typeof prop==="string"){prop=prop.replace("[",".").replace("]","").split(".")}if(prop.length>1){var e=prop.shift();assign(obj[e]=Object.prototype.toString.call(obj[e])==="[object Object]"?obj[e]:{},prop,value)}else{obj[prop[0]]=value}}function map(a,b){var m;var key;if(isFunction(b)){if(isObject(a)){m=[];for(key in a){if(a.hasOwnProperty(key)){m.push(b(a[key],key,a))}}return m}return a.map(b)}if(isObject(a)){m=[];for(key in a){if(a.hasOwnProperty(key)){m.push(a[key])}}return m}return a.map(function(aa){return aa[b]})}function keys(obj){return Object.keys(obj)}function sortBy(a,b){if(isFunction(b)){return a.sort(function(aa,bb){if(b(aa)>b(bb)){return 1}if(b(aa)<b(bb)){return-1}return 0})}}function forEach(a,b){if(isObject(a)){for(var key in a){if(a.hasOwnProperty(key)){b(a[key],key,a)}}return}if(isArray(a)){return a.forEach(b)}}function isUndefined(a){return typeof a==="undefined"}function pick(a,b){var c={};forEach(b,function(bb){if(typeof a[bb]!=="undefined"){c[bb]=a[bb]}});return c}function xor(a,b){var unique=[];forEach(a,function(aa){if(b.indexOf(aa)===-1){return unique.push(aa)}});forEach(b,function(bb){if(a.indexOf(bb)===-1){return unique.push(bb)}});return unique}function clone(a){return JSON.parse(JSON.stringify(a,function replacer(key,value){if(typeof value==="function"){return value.toString()}return value}))}function isEqual(x,y){if(typeof x==="object"&&x!==null&&(typeof y==="object"&&y!==null)){if(Object.keys(x).length!==Object.keys(y).length){return false}for(var prop in x){if(y.hasOwnProperty(prop)){if(!isEqual(x[prop],y[prop])){return false}}return false}return true}else if(x!==y){return false}return true}function replaceArray(a,b){var al=a.length;var bl=b.length;if(al>bl){a.splice(bl,al-bl)}else if(al<bl){a.push.apply(a,new Array(bl-al))}forEach(a,function(val,key){a[key]=b[key]});return a}function uniq(a){var seen=new Set;return a.filter(function(item){var allow=false;if(!seen.has(item)){seen.add(item);allow=true}return allow})}function flatten(aa){var flattened=[];for(var i=0;i<aa.length;++i){var current=aa[i];for(var j=0;j<current.length;++j){flattened.push(current[j])}}return flattened}function sort(arr){for(var i=1;i<arr.length;i++){var tmp=arr[i];var j=i;while(arr[j-1]>tmp){arr[j]=arr[j-1];--j}arr[j]=tmp}return arr}function values(a){var values=[];for(var key in a){if(a.hasOwnProperty(key)){values.push(a[key])}}return values}function recurseObject(obj,cb){_recurseObject(obj,[]);return obj;function _recurseObject(obj,path){for(var k in obj){var newPath=clone(path);newPath.push(k);if(typeof obj[k]==="object"&&obj[k]!==null){_recurseObject(obj[k],newPath)}else{if(!obj.hasOwnProperty(k)){continue}cb(obj[k],k,newPath)}}}}},{}],55:[function(require,module,exports){"use strict";var Promise=require("q");var _=require("./lodash");var aggregation=require("./aggregation");module.exports=function(){return{post:post,sortByKey:sortByKey,limit:limit,squash:squash,change:change,changeMap:changeMap};function post(query,parent,cb){query.data=cloneIfLocked(parent);return Promise.resolve(cb(query,parent))}function sortByKey(query,parent,desc){query.data=cloneIfLocked(parent);query.data=_.sortBy(query.data,function(d){return d.key});if(desc){query.data.reverse()}}function limit(query,parent,start,end){query.data=cloneIfLocked(parent);if(_.isUndefined(end)){end=start||0;start=0}else{start=start||0;end=end||query.data.length}query.data=query.data.splice(start,end-start)}function squash(query,parent,start,end,aggObj,label){query.data=cloneIfLocked(parent);start=start||0;end=end||query.data.length;var toSquash=query.data.splice(start,end-start);var squashed={key:label||"Other",value:{}};_.recurseObject(aggObj,function(val,key,path){var items=[];_.forEach(toSquash,function(record){items.push(_.get(record.value,path))});_.set(squashed.value,path,aggregation.aggregators[val](items))});query.data.splice(start,0,squashed)}function change(query,parent,start,end,aggObj){query.data=cloneIfLocked(parent);start=start||0;end=end||query.data.length;var obj={key:[query.data[start].key,query.data[end].key],value:{}};_.recurseObject(aggObj,function(val,key,path){var changePath=_.clone(path);changePath.pop();changePath.push(key+"Change");_.set(obj.value,changePath,_.get(query.data[end].value,path)-_.get(query.data[start].value,path))});query.data=obj}function changeMap(query,parent,aggObj,defaultNull){defaultNull=_.isUndefined(defaultNull)?0:defaultNull;query.data=cloneIfLocked(parent);_.recurseObject(aggObj,function(val,key,path){var changePath=_.clone(path);var fromStartPath=_.clone(path);var fromEndPath=_.clone(path);changePath.pop();fromStartPath.pop();fromEndPath.pop();changePath.push(key+"Change");fromStartPath.push(key+"ChangeFromStart");fromEndPath.push(key+"ChangeFromEnd");var start=_.get(query.data[0].value,path,defaultNull);var end=_.get(query.data[query.data.length-1].value,path,defaultNull);_.forEach(query.data,function(record,i){var previous=query.data[i-1]||query.data[0];_.set(query.data[i].value,changePath,_.get(record.value,path,defaultNull)-(previous?_.get(previous.value,path,defaultNull):defaultNull));_.set(query.data[i].value,fromStartPath,_.get(record.value,path,defaultNull)-start);_.set(query.data[i].value,fromEndPath,_.get(record.value,path,defaultNull)-end)})})}};function cloneIfLocked(parent){return parent.locked?_.clone(parent.data):parent.data}},{"./aggregation":46,"./lodash":54,q:18}],56:[function(require,module,exports){"use strict";var Promise=require("q");var _=require("./lodash");Promise.serial=serial;var isPromiseLike=function(obj){return obj&&_.isFunction(obj.then)};function serial(tasks){var prevPromise;var error=new Error;_.forEach(tasks,function(task,key){var success=task.success||task;var fail=task.fail;var notify=task.notify;var nextPromise;if(!prevPromise){nextPromise=success();if(!isPromiseLike(nextPromise)){error.message="Task "+key+" did not return a promise.";throw error}}else{nextPromise=prevPromise.then(function(data){if(!success){return data}var ret=success(data);if(!isPromiseLike(ret)){error.message="Task "+key+" did not return a promise.";throw error}return ret},function(reason){if(!fail){return Promise.reject(reason)}var ret=fail(reason);if(!isPromiseLike(ret)){error.message="Fail for task "+key+" did not return a promise.";throw error}return ret},notify)}prevPromise=nextPromise});return prevPromise||Promise.when()}},{"./lodash":54,q:18}],57:[function(require,module,exports){"use strict";var Promise=require("q");var _=require("./lodash");module.exports=function(service){var reductiofy=require("./reductiofy")(service);var filters=require("./filters")(service);var postAggregation=require("./postAggregation")(service);var postAggregationMethods=_.keys(postAggregation);return function doQuery(queryObj){var queryHash=JSON.stringify(queryObj);for(var i=0;i<service.columns.length;i++){for(var j=0;j<service.columns[i].queries.length;j++){if(service.columns[i].queries[j].hash===queryHash){return Promise.try(function(){return service.columns[i].queries[j]})}}}var query={original:queryObj,hash:queryHash};if(_.isUndefined(query.original)){query.original={}}if(_.isUndefined(query.original.select)){query.original.select={$count:true}}query.original.groupBy=query.original.groupBy||true;query=newQueryObj(query);return createColumn(query).then(makeCrossfilterGroup).then(buildRequiredColumns).then(setupDataListeners).then(applyQuery);function createColumn(query){return service.column({key:query.original.groupBy,type:_.isUndefined(query.type)?null:query.type,array:Boolean(query.array)}).then(function(){var column=service.column.find(query.original.groupBy);query.column=column;column.queries.push(query);column.removeListeners.push(function(){return query.clear()});return query})}function makeCrossfilterGroup(query){return Promise.resolve(query.column.dimension.group()).then(function(g){query.group=g;return query})}function buildRequiredColumns(query){var requiredColumns=filters.scanForDynamicFilters(query.original);if(requiredColumns.length){return Promise.all(_.map(requiredColumns,function(columnKey){return service.column({key:columnKey,dynamicReference:query.group})})).then(function(){return query})}return query}function setupDataListeners(query){var stopDataListen=service.onDataChange(function(){return applyQuery(query)});query.removeListeners.push(stopDataListen);var stopFilterListen=service.onFilter(function(){return postAggregate(query)});query.removeListeners.push(stopFilterListen);return query}function applyQuery(query){return buildReducer(query).then(applyReducer).then(attachData).then(postAggregate)}function buildReducer(query){return reductiofy(query.original).then(function(reducer){query.reducer=reducer;return query})}function applyReducer(query){return Promise.resolve(query.reducer(query.group)).then(function(){return query})}function attachData(query){return Promise.resolve(query.group.all()).then(function(data){query.data=data;return query})}function postAggregate(query){if(query.postAggregations.length>1){query.locked=true}return Promise.all(_.map(query.postAggregations,function(post){return post()})).then(function(){return query})}function newQueryObj(q,parent){var locked=false;if(!parent){parent=q;q={};locked=true}_.assign(q,{universe:service,crossfilter:service.cf,parent:parent,column:parent.column,dimension:parent.dimension,group:parent.group,reducer:parent.reducer,original:parent.original,hash:parent.hash,removeListeners:[],postAggregations:[],locked:locked,lock:lock,unlock:unlock,clear:clearQuery});_.forEach(postAggregationMethods,function(method){q[method]=postAggregateMethodWrap(postAggregation[method])});return q;function lock(set){if(!_.isUndefined(set)){q.locked=Boolean(set);return}q.locked=true}function unlock(){q.locked=false}function clearQuery(){_.forEach(q.removeListeners,function(l){l()});return Promise.try(function(){return q.group.dispose()}).then(function(){q.column.queries.splice(q.column.queries.indexOf(q),1);if(!q.column.queries.length){return service.clear(q.column.key)}}).then(function(){return service})}function postAggregateMethodWrap(postMethod){return function(){var args=Array.prototype.slice.call(arguments);var sub={};newQueryObj(sub,q);args.unshift(sub,q);q.postAggregations.push(function(){Promise.resolve(postMethod.apply(null,args)).then(postAggregateChildren)});return Promise.resolve(postMethod.apply(null,args)).then(postAggregateChildren);function postAggregateChildren(){return postAggregate(sub).then(function(){return sub})}}}}}}},{"./filters":53,"./lodash":54,"./postAggregation":55,"./reductiofy":59,q:18}],58:[function(require,module,exports){"use strict";module.exports={shorthandLabels:{$count:"count",$sum:"sum",$avg:"avg",$min:"min",$max:"max",$med:"med",$sumSq:"sumSq",$std:"std"},aggregators:{$count:$count,$sum:$sum,$avg:$avg,$min:$min,$max:$max,$med:$med,$sumSq:$sumSq,$std:$std,$valueList:$valueList,$dataList:$dataList}};function $count(reducer){return reducer.count(true)}function $sum(reducer,value){return reducer.sum(value)}function $avg(reducer,value){return reducer.avg(value)}function $min(reducer,value){return reducer.min(value)}function $max(reducer,value){return reducer.max(value)}function $med(reducer,value){return reducer.median(value)}function $sumSq(reducer,value){return reducer.sumOfSq(value)}function $std(reducer,value){return reducer.std(value)}function $valueList(reducer,value){return reducer.valueList(value)}function $dataList(reducer){return reducer.dataList(true)}},{}],59:[function(require,module,exports){"use strict";var reductio=require("reductio");var _=require("./lodash");var rAggregators=require("./reductioAggregators");var aggregation=require("./aggregation");module.exports=function(service){var filters=require("./filters")(service);return function reductiofy(query){var reducer=reductio();aggregateOrNest(reducer,query.select);if(query.filter){var filterFunction=filters.makeFunction(query.filter);if(filterFunction){reducer.filter(filterFunction)}}return Promise.resolve(reducer);function aggregateOrNest(reducer,selects){var sortedSelectKeyValue=_.sortBy(_.map(selects,function(val,key){return{key:key,value:val}}),function(s){if(rAggregators.aggregators[s.key]){return 0}return 1});return _.forEach(sortedSelectKeyValue,function(s){if(rAggregators.aggregators[s.key]){var accessor=aggregation.makeValueAccessor(s.value);reducer=rAggregators.aggregators[s.key](reducer,accessor);return}if(!_.isObject(s.value)){console.error("Nested selects must be an object",s.key);return}aggregateOrNest(reducer.value(s.key),s.value)})}}}},{"./aggregation":46,"./filters":53,"./lodash":54,"./reductioAggregators":58,reductio:39}],60:[function(require,module,exports){"use strict";require("./q.serial");var _=require("./lodash");module.exports=universe;function universe(data,options){var service={options:_.assign({},options),columns:[],filters:{},dataListeners:[],filterListeners:[]};var cf=require("./crossfilter")(service);var filters=require("./filters")(service);data=cf.generateColumns(data);return cf.build(data).then(function(data){service.cf=data;return _.assign(service,{add:cf.add,remove:cf.remove,column:require("./column")(service),query:require("./query")(service),filter:filters.filter,filterAll:filters.filterAll,applyFilters:filters.applyFilters,clear:require("./clear")(service),
destroy:require("./destroy")(service),onDataChange:onDataChange,onFilter:onFilter})});function onDataChange(cb){service.dataListeners.push(cb);return function(){service.dataListeners.splice(service.dataListeners.indexOf(cb),1)}}function onFilter(cb){service.filterListeners.push(cb);return function(){service.filterListeners.splice(service.filterListeners.indexOf(cb),1)}}}},{"./clear":47,"./column":48,"./crossfilter":49,"./destroy":50,"./filters":53,"./lodash":54,"./q.serial":56,"./query":57}]},{},[60])(60)});